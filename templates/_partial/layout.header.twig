{% import _self as nav_macros %}
{% import "_partial/macros.twig" as macros %}

<header role="banner">
    {% block banner %}
        <div class="hal">
            <div class="wrapper">

                <h1 class="hal-label">
                    <span class="hal-label__name">HAL</span>
                    <span class="hal-label__version">9000 {% if tick.isUpdateTickOn %}
                        <a class="hal-stamp" href="{{ urlFor('latest.release') }}" title="HAL 9000 was recently updated!">{{ macros.icon('star') }}</a>
                    {% endif %}</span>
                </h1>

                <a href="/">
                    <div class="hal-eye circular">
                        <div class="ring circular"></div>
                        <div class="oculus circular">
                            <div class="iris circular narrow"></div>
                            <div class="iris circular wide"></div>
                            <div class="highlight alpha"></div>
                            <div class="highlight"></div>
                            <div class="highlight beta"></div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    {% endblock %}

    {% block navigation %}
        {% if showNavigation %}
            <nav role="navigation">
                <ul class="nav--main mbn">
                    {% if currentUser %}
                        {{ nav_macros.optionalNavlink('Dashboard', 'dashboard', 'dashboard') }}
                        {{ nav_macros.optionalNavlink('Queue', 'queue', 'in') }}

                        {{ nav_macros.optionalNavlink('Applications', 'applications', 'list') }}

                        {{ nav_macros.optionalNavlink('Servers', 'servers', 'server') }}
                        {{ nav_macros.optionalNavlink('Environments', 'environments', 'leaf') }}
                        {{ nav_macros.optionalNavlink('Users', 'users', 'users') }}

                        {% if isUserAdminOrSuper(currentUser) %}
                            {{ nav_macros.optionalNavlink('Admin', 'admin', 'watch') }}
                        {% endif %}
                        {{ nav_macros.optionalNavlink('Help', 'help', 'question') }}
                        {{ nav_macros.optionalNavlink('Kraken', 'kraken', 'squid') }}

                        <li>{{ nav_macros.navlink('Settings', 'settings', 'settings') }}</li>
                        <li>{{ nav_macros.navlink('Logout', 'logout', 'sign-out') }}</li>

                    {% else %}
                        <li class="signed-out">{{ nav_macros.navlink('Help', 'help', 'question') }}</li>
                        <li class="signed-out">{{ nav_macros.navlink('Login', 'login', 'sign-in') }}</li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    {% endblock %}
</header>

{% macro navlink(title, key, icon) %}
    {% import "_partial/macros.twig" as macros %}
    <a href="{{ urlFor(key) }}" title="{{ title }}">
        {{ macros.icon(icon) }}
        {{ title }}
    </a>
{% endmacro %}

{% macro optionalNavlink(title, key, icon) %}
    {% import _self as nav_macros %}
    {% if isNavOn(key) %}
        <li>{{ nav_macros.navlink(title, key, icon) }}</li>
    {% endif %}
{% endmacro %}
