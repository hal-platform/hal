{% extends 'base.twig' %}
{% import 'macros.twig' as macros %}
{% import 'application/macros.applications.twig' as apps_macros %}
{% set js_components = ['applications_list'] %}

{% set page_title = 'Applications' %}

{% block content %}
    <h1>{{ page_title }}</h1>
    {{ block('favs') }}

    <h2>Organizations</h2>
    {{ block('orgs_grid') }}

    <h2>Applications</h2>
    {{ block('apps_table') }}

    <ul>
        <li><a class="btn" href="{{ uriFor('application.add') }}">Add Application</a></li>
        <li><a class="btn" href="{{ uriFor('organization.add') }}">Add Organization</a></li>
    </ul>
{% endblock %}

{% block favs %}

    {% if favorites %}
        <h2>Favorites</h2>
        <table class="table--spacing-medium">
            <thead>
                <tr>
                    <th>Application</th>
                    <th class="t50">GitHub Source</th>
                    <th class="t5"></th>
                </tr>
            </thead>
            <tbody>
                {% for application in favorites %}
                    {{ apps_macros.app_row(current_user, application) }}
                {% endfor %}
            </tbody>
        </table>

    {% endif %}

{% endblock %}

{% block orgs_grid %}

    {% if organizations %}
        <ul>
            {% for organization in organizations %}
                <li><a href="#org-{{ organization.id }}">{{ organization.name }}</a></li>
            {% endfor %}

            {% if applications.none %}
                <li><a href="#org-none">Not in organization</a></li>
            {% endif %}
        </ul>
    {% else %}
        <p>There are no organizations.</p>
    {% endif %}

{% endblock %}

{% block apps_table %}

    {% if applications %}

        <input
            id="js-search-input"
            class="text-input"
            type="text"
            name="search"
            autocomplete="off"
            placeholder="Search for an application or repository..."
            maxlength="100">

        <table class="table--spacing-medium js-collapsible js-search-table">
            <thead>
                <tr>
                    <th>Application</th>
                    <th class="t40">GitHub Source</th>
                    <th class="t15 js-collapsible-global"></th>
                </tr>
            </thead>

            {% set hasApplications = false %}

            {% for org_id, organization_apps in applications %}
                <tbody class="js-search-group">
                    {% set organization = organizations[org_id] %}

                    {% if organization %}
                        <tr>
                            <th colspan="3" class="table-mid-header" id="org-{{ org_id }}">
                                <a href="{{ uriFor('organization', {'organization': organization.id}) }}">{{ organization.name }}</a>
                            </th>
                        </tr>
                    {% else %}
                        <tr>
                            <th colspan="3" class="table-mid-header" id="org-none">
                                None
                            </th>
                        </tr>

                    {% endif %}

                    {% if organization_apps %}
                        {% set hasApplications = true %}
                        {% for application in organization_apps %}
                            {{ apps_macros.app_row(current_user, application, true) }}
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="3">No applications found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            {% endfor %}
        </table>

    {% else %}
        <p>There are no applications.</p>
    {% endif %}

{% endblock %}
