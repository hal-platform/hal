{% extends 'base.twig' %}
{% import "_partial/macros.twig" as macros %}

{% set page_title = 'Application : ' ~ application.name %}

{% set isAdmin = isUserAdminOrSuper(current_user) %}
{% set canEdit = isUserAdminOrSuper(current_user) or isUserLeadOf(current_user, application) %}
{% set canRemove = isAdmin and not has_deployments %}

{% block content %}
    <h1>Application - <strong>{{ application.name }}</strong></h1>

    {{ block('meta') }}

    <h2>Notifications</h2>
    <div class="details-box">
        <dl class="split mbn">
            <dt class="split__title">Email</dt>
            <dd>{{ application.email ?: 'None' }}</dd>
        </dl>
    </div>

    <ul class="button-list">
        <li><a class="btn" href="{{ uriFor('application.dashboard', {application: application.id}) }}">Application Status</a></li>

        <li><a class="btn btn--secondary" href="{{ uriFor('encrypted', {application: application.id}) }}">Encrypted Properties</a></li>
        <li><a class="btn btn--secondary" href="{{ uriFor('deployments', {application: application.id}) }}">Deployment Targets</a></li>
    </ul>

    {% if canEdit or canRemove %}
        <ul class="leader button-list button-list--half">
            {% if canEdit %}
                <li><a class="btn btn--action" href="{{ uriFor('application.edit', {application: application.id}) }}">Edit Application</a></li>
            {% endif %}

            {% if canRemove %}
                <li class="button-list__fixed"><a class="btn btn--destructive" href="{{ uriFor('application.remove', {application: application.id}) }}">Remove Application</a></li>
            {% endif %}
        </ul>
    {% endif %}

{% endblock %}

{% block meta %}
    <div class="details-box">
        <dl class="split">
            <dt class="split__title">Name</dt>
            <dd>{{ application.name }}</dd>

            <dt class="split__title">Identifier</dt>
            <dd>{{ application.key }}</dd>

            <dt class="split__title">GitHub Source</dt>
            <dd>{{ macros.gitsource(application) }}</dd>
        </dl>
    </div>
{% endblock %}
