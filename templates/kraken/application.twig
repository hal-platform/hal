{% extends 'base.kraken.twig' %}
{% import "partials/macros.twig" as macros %}

{% set page_title = "Application" %}

{% block content %}

    <a href="{{ urlFor('kraken.applications') }}" class="btn" style="position:absolute; right:20px;top:20px !important;">back</a>
    <h1>Application</h1>

    <h4>ID</h4>
    <p>{{ application.id }}</p>

    <h2>Environments</h2>
    {% if targets %}
        <p><a href="{{ urlFor('kraken.status', {application: application.id}) }}">Configuration Status</a></p>

        <table class="table--spacing-medium">
            <thead>
                <tr>
                    <th>Name</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for target in targets %}
                    <tr>
                        <td>{{ target.environment.name }}</td>
                        <td>
                            <a href="{{ urlFor('kraken.application.target', {application: application.id, environment: target.environment.id})}}">Manage</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    {% else %}
        <p>There are no environments linked to this application.</p>
    {% endif %}

    {% if environments %}
        <p><a href="{{ urlFor('kraken.application.add_target', {application: application.id}) }}">Add Target</a></p>
    {% endif %}

    <h2>Configuration Schema</h2>
    <p><a href="{{ urlFor('kraken.application.add_schema', {application: application.id}) }}">Add Property</a></p>
    {{ block('configuration_schema') }}

{% endblock %}

{% block configuration_schema %}

    {% if schema %}
        <table class="table--spacing-medium">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for prop in schema %}
                    <tr>
                        <td><code>{{ prop.key }}</code></td>
                        <td>
                            {{ prop.isSecure ? macros.icon('locked') : '' }}
                            {{ prop|formatSchemaType }}
                        </td>
                        <td>{{ prop.description }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>There is no schema defined for this application.</p>
    {% endif %}

{% endblock %}
