{% extends 'base.kraken.twig' %}
{% import "_partial-form/macros.twig" as form_macros %}

{% set page_title = "Add Application" %}

{% block content %}

    <h1>{{ page_title }}</h1>

    <div class="form-wrapper">

        {{ form_macros.formErrors(errors) }}

        <form action="" method="post">
            <ul class="form-fields">

                <li>
                    <label for="app-coreid">CORE Application ID</label>
                    <input type="numeric" name="core_id" id="app-coreid" maxlength="64" required value="{{ form.core_id }}" class="text-input t40">
                </li>


                <li>
                    <label for="app-hal_app">
                        Hal Application
                        <small class="additional">
                            Link a Hal application to this Kraken application. Recommended for applications already using Hal.
                        </small>
                    </label>

                    {% if available %}

                        <select class="select-input" name="hal_app" id="app-hal_app">
                            <option></option>
                            {% for available_groups in available %}
                                {% set firstApp = available_groups|first %}

                                <optgroup label="{{ firstApp.group.name }}">
                                    {% for hal_application in available_groups %}
                                        {% set isSelected = (hal_application.id == form.hal_app) %}
                                        <option value="{{ hal_application.id }}"{{ isSelected ? ' selected' : '' }}>{{ hal_application.name }}</option>
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                        </select>

                    {% else %}
                        <p>No Hal applications are available to be linked.</p>
                    {% endif %}
                </li>

                <li>
                    <label for="app-name">
                        Name
                        <small class="additional">
                            Optional when linking to a Hal application.
                        </small>
                    </label>
                    <input type="text" name="name" id="app-name" maxlength="64" value="{{ form.name }}" class="text-input">
                </li>
            </ul>

            <ul class="button-list">
                <li><input class="btn btn--action" type="submit" value="Add Application"></li>
                <li class="button-list__fixed"><a class="btn btn--secondary" href="{{ urlFor('kraken.applications') }}">Cancel</a></li>
            </ul>

        </form>
    </div>
{% endblock %}
