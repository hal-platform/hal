{% import "partials/macros.twig" as macros %}
{% import "kraken/partial/macros.twig" as kraken_macros %}

{% if properties %}
    <table class="table--spacing-medium table--striped table--top-aligned" data-tablesaw-mode="stack">
        <thead>
            <tr>
                {% if show_property_link or is_deployed %}
                    <th></th>
                {% endif %}
                <th>Property</th>
                <th class="t15">Type</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            {% for property in properties %}

                {% if property is diff %}
                    {% set property = property.property ? property.property : property.schema %}
                {% endif %}

                <tr>
                    {% if property is property %}

                        {% if show_property_link %}
                            <td>
                                <a href="{{ urlFor('kraken.property', {property: property.id}) }}">
                                    {{ macros.icon('list') }}
                                    <span class="tablesaw-collapse">Manage Property Schema</span>
                                </a>
                            </td>

                        {% endif %}

                        <td><code class="code_clear">{{ property.schema.key }}</code></td>
                        <td>{{ property.schema|formatSchemaType }}</td>

                        <td>{{ kraken_macros.renderProperty(property) }}</td>

                    {% elseif property is configurationProperty %}

                        {% if show_property_link or is_deployed %}
                            <td>
                                {% if checksums[property.key] == property.checksum %}
                                    {{ macros.status_icon('', 'success', {title: 'Verified'}) }}
                                    <span class="tablesaw-collapse">Verified</span>
                                {% else %}
                                    {{ macros.status_icon('', 'error', {title: 'Missing or different from consul backend'}) }}
                                    <span class="tablesaw-collapse">Missing or different from consul backend</span>
                                {% endif %}
                            </td>
                        {% endif %}

                        <td><code class="code_clear">{{ property.key }}</code></td>
                        <td>{{ property|formatSchemaType }}</td>

                        <td>{{ kraken_macros.renderProperty(property) }}</td>

                    {% else %}
                        {% if show_property_link %}
                            <td></td>
                        {% endif %}

                        <td><code class="code_clear">{{ property.key }}</code></td>
                        <td>{{ property|formatSchemaType }}</td>

                        <td>
                            {{ macros.status('Missing', 'error', 'spam-2') }}
                        </td>
                    {% endif %}

                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>This configuration has no properties.</p>
{% endif %}
