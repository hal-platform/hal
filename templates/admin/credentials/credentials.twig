{% extends 'base.html.twig' %}

{% set page_title = "Credentials" %}

{% set isSuper = isUserSuper(currentUser) %}

{% block content %}
    <h1>{{ page_title }}</h1>

    <p>
        Credentials can be stored and encrypted in the HAL database for use by deployments.
        <b>Currently, credentials can only be used by AWS-based deployments.</b>
    </p>

    <p>
        Eventually, ssh deployments will use these credentials, but today is not yet that day.
    </p>

    {% if credentials %}
        <table class="table--spacing-medium table--striped table--top-aligned" data-tablesaw-mode="stack">
            <thead>
                <tr class="tl">
                    <th>ID</th>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for credential in credentials %}
                    <tr>
                        <td>
                            <a href="{{ urlFor('admin.credential', {'credential': credential.id }) }}">{{ credential.id[:7] }}</a></td>
                        <td>
                            {% if credential.type == 'aws' %}
                                AWS
                            {% elseif credential.type == 'privatekey' %}
                                Private Key
                            {% endif %}
                        </td>

                        <td>{{ credential.name }}</td>
                        <td>
                            {% if credential.type == 'aws' %}
                                Key: <code class="code_clear">{{ credential.aws.key }}</code>
                            {% elseif credential.type == 'privatekey' %}
                                Username: <code class="code_clear">{{ credential.privatekey.username }}</code>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>There are no credentials stored.</p>
    {% endif %}

    {% if isSuper %}
        <ul class="button-list button-list--half">
            <li><a class="btn" href="{{ urlFor('admin.credential.add') }}">Add Credentials</a></li>
        </ul>
    {% endif %}

{% endblock %}
