{% extends 'base.html.twig' %}
{% import "_partial/macros.twig" as macros %}
{% import "_partial-form/macros.twig" as form_macros %}

{% set page_title = "Add Permissions" %}

{% block content %}

    <h1>{{ page_title }}</h1>

    <h2>Current Permissions - <strong>{{ selectedUser.handle }}</strong></h2>
    <div class="details-box">
        <dl class="split mbn">

            <dt class="split__title">Current User Types</dt>
            <dd>
                {% if userPerm.isLead or userPerm.isButtonPusher or userPerm.isSuper %}
                    <ul class="inline-list--space">
                        {% if userPerm.isLead %}
                            <li>{{ macros.status('Lead', 'notice') }}</li>
                        {% endif %}
                        {% if userPerm.isButtonPusher %}
                            <li>{{ macros.status('Admin', 'warning') }}</li>
                        {% endif %}
                        {% if userPerm.isSuper %}
                            <li>{{ macros.status('Super', 'error') }}</li>
                        {% endif %}
                    </ul>
                {% else %}
                    Standard
                {% endif %}
            </dd>

            {% if leadApplications %}
                <dt class="split__title">Lead Applications</dt>
                <dd>
                    <ul class="inline-list--comma">
                        {% for application in leadApplications %}
                            <li><a href="{{ urlFor('repository', {id: application.id}) }}">{{ application.name }}</a></li>
                        {% endfor %}
                    </ul>
                </dd>
            {% endif %}
        </dl>
    </div>

    <h2>Add Permissions</h2>

    <div class="form-wrapper">
        {{ form_macros.formErrors(errors) }}

        <form method="post">
            <ul class="form-fields">
                <li>
                    <label>Permission Type</label>
                    <ul class="radio-grid--form">
                        {% for user_type, human in availableTypes %}
                            {% set checked = '' %}
                            {% if form.type == user_type %}
                                {% set checked = ' checked' %}
                            {% endif %}

                            <li>
                                <input id="perm-{{ user_type}}" type="radio" name="type" value="{{ user_type }}"{{ checked }}>
                                <label for="perm-{{ user_type }}">{{ human }}</label>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
                <li>
                    <label for="perm-app">Application</label>
                    <small class="additional">
                        Optional. Only required when adding Application Lead permissions.
                    </small>

                    <select name="application" id="perm-app">
                        <option value=""></option>
                        {% for applicationId, applicationName in availableApplications %}
                            {% set selected = '' %}
                            {% if form.application == applicationId %}
                                {% set selected = ' selected' %}
                            {% endif %}

                            <option value="{{ applicationId }}"{{ selected }}>{{ applicationName }}</option>
                        {% endfor %}
                    </select>
                </li>
            </ul>

            <ul class="button-list">
                <li><input class="btn btn--action" type="submit" value="Add Permissions"></li>
                <li class="button-list__fixed"><a class="btn btn--secondary" href="{{ urlFor('users') }}">Cancel</a></li>
            </ul>

        </form>
    </div>
{% endblock %}
