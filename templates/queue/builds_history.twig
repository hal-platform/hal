{% extends 'base.twig' %}
{% import 'macros.pagination.twig' as pagination %}
{% import 'macros.git.twig' as git %}
{% import 'macros.twig' as macros %}
{% set js_components = ['job_table_updater'] %}

{% set page_title = "Build History" %}

{% block content %}
    <div class="nav--page">
        <h1>Build History</h1>

        <p class="nav--page__back">
            <a class="btn btn--small btn--back" href="{{ uriFor('queue.history.page1') }}">Queue History</a>
            <a class="btn btn--small btn--back" href="{{ uriFor('releases.history.page1') }}">All Releases</a>
        </p>
    </div>

    {{ pagination.pagination(page, last, 'builds.history') }}

    {{ block('builds') }}

    {{ pagination.pagination(page, last, 'builds.history') }}

{% endblock %}

{% block builds %}
    <table class="table--spacing-medium" data-tablesaw-mode="stack">
        <thead>
            <tr>
                <th>Push</th>
                <th>Application</th>
                <th>Env</th>
                <th>Git</th>
                <th class="table-priority-55">User</th>
                <th class="table-priority-50">Time</th>
            </tr>
        </thead>
        <tbody>
            {% for build in builds %}
                <tr>
                    <td>{{ macros.job_status_prefix(build) }}</td>

                    <td>
                        <a href="{{ uriFor('application.dashboard', {application: build.application.id}) }}">{{ build.application.name }}</a>
                    </td>

                    <td>{{ build.environment ? build.environment.name : 'Any' }}</td>
                    <td>{{ git.gitref(build, true) }}</td>

                    <td class="table-priority-55">
                        {% if build.user %}
                            <a href="{{ uriFor('user', {'user': build.user.id}) }}">{{ build.user.username }}</a>
                        {% else %}
                            Unknown
                        {% endif %}
                    </td>

                    <td class="table-priority-50">
                        {{ build.created|html5date }}
                    </td>

                </tr>
            {% else %}
                <tr id="js-emptyQueue">
                    <td colspan="6">There are no builds to display.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
