parameters:
    routes.regex.alphanum: '[A-Za-z0-9]+'
    routes.regex.digit: '[0-9]+'
    routes.regex.guid: '[0-9a-zA-Z]{32,32}'

    routes.regex.buildId: '[A-Za-z0-9\_\-\.]+'
    routes.regex.pushId: %routes.regex.buildId%

    routes:
        login:
            method: ['GET', 'POST']
            route: '/login'
            stack: ['login.handler', 'login.page']

        dashboard:
            method: 'GET'
            route: '/'
            stack: ['middleware.login', 'dashboard.page']

        logout:
            method: 'GET'
            route: '/logout'
            stack: ['logout.handler']

        debug:
            method: 'GET'
            route:  '/debug'
            stack:  ['middleware.login', 'debug.page']

        github.authorization:
            method: 'GET'
            route:  '/github-authorization'
            stack:  ['middleware.login', 'github.authorization.page']

        github.authorization.remove:
            method: ['GET', 'POST']
            route:  '/settings/remove-github-authorization'
            stack:  ['middleware.login', 'github.authorization.remove.page']

        ################################################################################################################
        # QUEUE ROUTES
        ################################################################################################################

        queue:
            method: 'GET'
            route: '/queue'
            stack: ['middleware.login', 'queue.page']

        queue.history.page1:
            method: 'GET'
            route: '/queue-history'
            stack: ['middleware.login', 'queue.history.page']

        queue.history:
            method: 'GET'
            route: '/queue-history/date/:date'
            stack: ['middleware.login', 'queue.history.page']
            conditions: {date: '[0-9]{4}-[0-9]{2}-[0-9]{2}'}

        ################################################################################################################
        # ADMIN ROUTES
        ################################################################################################################

        admin:
            method: 'GET'
            route: '/admin'
            stack: ['middleware.admin', 'admin.dashboard.page']

        admin.audit.logs.page1:
            method: 'GET'
            route: '/admin/audit-logs'
            stack: ['middleware.admin', 'admin.audit.logs.page']

        admin.audit.logs:
            method: 'GET'
            route: '/admin/audit-logs/page/:page'
            stack: ['middleware.admin', 'admin.audit.logs.page']
            conditions: {page: %routes.regex.digit%}

        ################################################################################################################
        # ADMIN ROUTES - PERMISSIONS
        ################################################################################################################

        admin.permissions:
            method: 'GET'
            route: '/admin/permissions'
            stack: ['middleware.admin', 'admin.permissions.page']

        admin.permissions.deployment:
            method: 'GET'
            route: '/admin/permissions/deployment'
            stack: ['middleware.admin', 'admin.permissions.deployment.page']

        admin.permissions.remove.confirm:
            method: 'GET'
            route: '/admin/permissions/:userType/remove'
            stack: ['middleware.admin', 'middleware.requireEntity', 'admin.permissions.remove.page']
            conditions: {userType: %routes.regex.guid%}
        admin.permissions.remove:
            method: 'POST'
            route: '/admin/permissions/:userType/remove'
            stack: ['middleware.admin', 'middleware.requireEntity', 'admin.permissions.remove.handler']
            conditions: {userType: %routes.regex.guid%}

        admin.permissions.add:
            method: ['GET', 'POST']
            route: '/admin/permissions/:user/add'
            stack: ['middleware.admin', 'middleware.requireEntity', 'admin.permissions.add.page']
            conditions: {user: %routes.regex.digit%}

        admin.permissions.deployment.remove.confirm:
            method: 'GET'
            route: '/admin/permissions/deployment/:userPermission/remove'
            stack: ['middleware.admin', 'middleware.requireEntity', 'admin.permissions.deployment.remove.page']
            conditions: {userPermission: %routes.regex.guid%}
        admin.permissions.deployment.remove:
            method: 'POST'
            route: '/admin/permissions/deployment/:userPermission/remove'
            stack: ['middleware.admin', 'middleware.requireEntity', 'admin.permissions.deployment.remove.handler']
            conditions: {userPermission: %routes.regex.guid%}

        ################################################################################################################
        # SUPER ADMIN ROUTES
        ################################################################################################################

        admin.super:
            method: 'GET'
            route: '/superadmin'
            stack: ['middleware.super', 'admin.super.page']

        admin.super.caches:
            method: ['GET', 'POST']
            route: '/superadmin/caches'
            stack: ['middleware.super', 'admin.caches.handler', 'admin.caches.page']

        admin.super.users:
            method: 'GET'
            route: '/superadmin/users'
            stack: ['middleware.super', 'admin.users.page']

        admin.super.message:
            method: ['GET', 'POST']
            route: '/superadmin/message'
            stack: ['middleware.super', 'admin.message.page']

        ################################################################################################################
        # HELP ROUTES
        ################################################################################################################

        help:
            method: 'GET'
            route: '/help'
            stack: ['help.page']

        help.deployment:
            method: 'GET'
            route: '/help/deployment'
            stack: ['help.deployment.page']

        help.hal:
            method: 'GET'
            route: '/help/hal'
            stack: ['help.hal.page']

        help.githubpermissions:
            method: 'GET'
            route: '/help/github-permissions'
            stack: ['help.githubpermissions.page']

        # help.api:
        #     method: 'GET'
        #     route: '/help/api'
        #     stack: ['help.api.page']

        ################################################################################################################
        # BUILD ROUTES
        ################################################################################################################

        build.history.page1:
            method: 'GET'
            route: '/repositories/:id/builds'
            stack: ['middleware.login', 'builds.page']
            conditions: {id: %routes.regex.digit%}
        build.history:
            method: 'GET'
            route: '/repositories/:id/builds(/page/:page)'
            stack: ['middleware.login', 'builds.page']
            conditions:
                id: %routes.regex.digit%
                page: %routes.regex.digit%

        build:
            method: 'GET'
            route: '/builds/:build'
            stack: ['middleware.login', 'build.page']
            conditions: {build: %routes.regex.buildId%}

        build.start:
            method: ['GET', 'POST']
            route: '/repositories/:id/build'
            stack: ['middleware.login', 'build.start.handler', 'build.start.page']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # PUSH ROUTES
        ################################################################################################################

        push:
            method: 'GET'
            route: '/pushes/:push'
            stack: ['middleware.login', 'push.page']
            conditions: {push: %routes.regex.pushId%}

        push.start:
            method: ['GET', 'POST']
            route: '/builds/:build/push'
            stack: ['middleware.login', 'push.start.handler', 'push.start.page']
            conditions: {build: %routes.regex.buildId%}

        push.history.page1:
            method: 'GET'
            route: '/repositories/:id/pushes'
            stack: ['middleware.login', 'pushes.page']
            conditions: {id: %routes.regex.digit%}
        push.history:
            method: 'GET'
            route: '/repositories/:id/pushes(/page/:page)'
            stack: ['middleware.login', 'pushes.page']
            conditions:
                id: %routes.regex.digit%
                page: %routes.regex.digit%

        rollback.page1:
            method: 'GET'
            route: '/repositories/:id/deployments/:deployment/pushes'
            stack: ['middleware.login', 'push.rollback.page']
            conditions:
                id: %routes.regex.digit%
                deployment: %routes.regex.digit%

        rollback:
            method: 'GET'
            route: '/repositories/:id/deployments/:deployment/pushes(/page/:page)'
            stack: ['middleware.login', 'push.rollback.page']
            conditions:
                id: %routes.regex.digit%
                deployment: %routes.regex.digit%

        ################################################################################################################
        # SERVER ROUTES
        ################################################################################################################

        servers:
            method: 'GET'
            route: '/servers'
            stack: ['middleware.login', 'servers.page']

        server:
            method: 'GET'
            route: '/servers/:id'
            stack: ['middleware.login', 'server.page']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # SERVER ROUTES - ADMIN
        ################################################################################################################

        server.admin.add:
            method: ['GET', 'POST']
            route: '/servers/add'
            stack: ['middleware.admin', 'server.admin.add.page']

        server.admin.edit:
            method: ['GET', 'POST']
            route: '/servers/:id/edit'
            stack: ['middleware.admin', 'server.admin.edit.page']
            conditions: {id: %routes.regex.digit%}

        server.admin.remove.confirm:
            method: 'GET'
            route: '/servers/:id/remove'
            stack: ['middleware.admin', 'delete.confirm.page']
            conditions: {id: %routes.regex.digit%}
        server.admin.remove:
            method: 'POST'
            route: '/servers/:id/remove'
            stack: ['middleware.admin', 'server.admin.remove.handler']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # USER ROUTES
        ################################################################################################################

        user:
            method: 'GET'
            route: '/users/:user'
            stack: ['middleware.login', 'middleware.requireEntity', 'user.page']
            conditions: {user: %routes.regex.digit%}

        settings:
            method: 'GET'
            route: '/settings'
            stack: ['middleware.login', 'user.settings.page']

        settings.handler:
            method: 'POST'
            route: '/users/:id/preferences'
            stack: ['middleware.login', 'user.settings.handler']
            conditions: {id: %routes.regex.digit%}

        users:
            method: 'GET'
            route: '/users'
            stack: ['middleware.login', 'users.page']

        ################################################################################################################
        # USER TOKEN MANAGEMENT ROUTES
        ################################################################################################################

        user.token.add:
            method: 'POST'
            route: '/users/:id/tokens'
            stack: ['middleware.login', 'user.token.add.handler']
            conditions: {id: %routes.regex.digit%}

        user.token.remove.confirm:
            method: 'GET'
            route: '/users/:id/tokens/:token/revoke'
            stack: ['middleware.login', 'delete.confirm.page']
            conditions:
                id: %routes.regex.digit%
                token: %routes.regex.guid%
        user.token.remove:
            method: 'POST'
            route: '/users/:id/tokens/:token/revoke'
            stack: ['middleware.login', 'user.token.remove.handler']
            conditions:
                id: %routes.regex.digit%
                token: %routes.regex.guid%

        ################################################################################################################
        # REPOSITORY ROUTES
        ################################################################################################################

        repositories:
            method: 'GET'
            route: '/repositories'
            stack: ['middleware.login', 'repositories.page']

        repository:
            method: 'GET'
            route: '/repositories/:id'
            stack: ['middleware.login', 'repository.page']
            conditions: {id: %routes.regex.digit%}

        repository.status:
            method: 'GET'
            route: '/repositories/:id/status'
            stack: ['middleware.login', 'repository.status.sticky.handler', 'repository.status.page']
            conditions: {id: %routes.regex.digit%}

        repository.admin.add:
            method: ['GET', 'POST']
            route: '/repositories/add'
            stack: ['middleware.login', 'repository.admin.add.page']

        repository.admin.edit:
            method: ['GET', 'POST']
            route: '/repositories/:repository/edit'
            stack: ['middleware.lead', 'repository.admin.edit.page']
            conditions: {repository: %routes.regex.digit%}

        ################################################################################################################
        # REPOSITORY ROUTES - ADMIN
        ################################################################################################################

        repository.admin.remove.confirm:
            method: 'GET'
            route: '/repositories/:id/remove'
            stack: ['middleware.admin', 'delete.confirm.page']
            conditions: {id: %routes.regex.digit%}
        repository.admin.remove:
            method: 'POST'
            route: '/repositories/:id/remove'
            stack: ['middleware.admin', 'repository.admin.remove.handler']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # REPOSITORY DEPLOYMENT ROUTES
        ################################################################################################################

        repository.deployment:
            method: 'GET'
            route: '/repositories/:repository/deployments/:id'
            stack: ['middleware.login', 'repository.deployment.page']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.digit%

        repository.deployments:
            method: 'GET'
            route: '/repositories/:repository/deployments'
            stack: ['middleware.login', 'repository.deployments.page']
            conditions: {repository: %routes.regex.digit%}

        repository.deployments.add:
            method: ['GET', 'POST']
            route: '/repositories/:repository/deployments/add'
            stack: ['middleware.lead', 'repository.deployments.add.handler', 'repository.deployments.add.page']
            conditions: {repository: %routes.regex.digit%}

        repository.deployment.edit:
            method: ['GET', 'POST']
            route: '/repositories/:repository/deployments/:id/edit'
            stack: ['middleware.lead', 'repository.deployment.edit.handler', 'repository.deployment.edit.page']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.digit%

        repository.deployment.remove.confirm:
            method: 'GET'
            route: '/repositories/:repository/deployments/:id/remove'
            stack: ['middleware.lead', 'delete.confirm.page']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.digit%

        repository.deployment.remove:
            method: 'POST'
            route: '/repositories/:repository/deployments/:id/remove'
            stack: ['middleware.lead', 'repository.deployments.remove.handler']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.digit%

        ################################################################################################################
        # REPOSITORY ENCRYPTED PROPERTIES ROUTES
        ################################################################################################################

        repository.encrypted:
            method: 'GET'
            route: '/repositories/:repository/encrypted-properties'
            stack: ['middleware.login', 'repository.encrypted.page']
            conditions: {repository: %routes.regex.digit%}

        repository.encrypted.add:
            method: ['GET', 'POST']
            route: '/repositories/:repository/encrypted-properties/add'
            stack: ['middleware.lead', 'repository.encrypted.add.handler', 'repository.encrypted.add.page']
            conditions: {repository: %routes.regex.digit%}

        repository.encrypted.remove.confirm:
            method: 'GET'
            route: '/repositories/:repository/encrypted-properties/:id/remove'
            stack: ['middleware.lead', 'delete.confirm.page']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.guid%
        repository.encrypted.remove:
            method: ['POST']
            route: '/repositories/:repository/encrypted-properties/:id/remove'
            stack: ['middleware.lead', 'repository.encrypted.remove.handler']
            conditions:
                repository: %routes.regex.digit%
                id: %routes.regex.guid%

        ################################################################################################################
        # GROUP ROUTES
        ################################################################################################################

        groups:
            method: 'GET'
            route: '/groups'
            stack: ['middleware.login', 'repositories.page']

        group:
            method: 'GET'
            route: '/groups/:id'
            stack: ['middleware.login', 'group.page']
            conditions: {id: %routes.regex.digit%}

        group.admin.add:
            method: ['GET', 'POST']
            route: '/groups/add'
            stack: ['middleware.login', 'group.admin.add.page']

        ################################################################################################################
        # GROUP ROUTES - ADMIN
        ################################################################################################################

        group.admin.edit:
            method: ['GET', 'POST']
            route: '/groups/:id/edit'
            stack: ['middleware.admin', 'group.admin.edit.page']
            conditions: {id: %routes.regex.digit%}

        group.admin.remove.confirm:
            method: 'GET'
            route: '/groups/:id/remove'
            stack: ['middleware.admin', 'delete.confirm.page']
            conditions: {id: %routes.regex.digit%}
        group.admin.remove:
            method: 'POST'
            route: '/groups/:id/remove'
            stack: ['middleware.admin', 'group.admin.remove.handler']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # ENVIRONMENT ROUTES
        ################################################################################################################

        environments:
            method: 'GET'
            route: '/environments'
            stack: ['middleware.login', 'environments.page']
            conditions: {id: %routes.regex.digit%}

        environment:
            method: 'GET'
            route: '/environments/:id'
            stack: ['middleware.login', 'environment.page']
            conditions: {id: %routes.regex.digit%}

        ################################################################################################################
        # ENVIRONMENT ROUTES - ADMIN
        ################################################################################################################

        environment.admin.add:
            method: ['GET', 'POST']
            route: '/environments/add'
            stack: ['middleware.admin', 'environment.admin.add.page']

        environment.admin.remove.confirm:
            method: 'GET'
            route: '/environments/:id/delete'
            stack: ['middleware.admin', 'delete.confirm.page']
            conditions: {id: %routes.regex.digit%}
        environment.admin.remove:
            method: 'POST'
            route: '/environments/:id/delete'
            stack: ['middleware.admin', 'environment.admin.remove.handler']
            conditions: {id: %routes.regex.digit%}

        environment.admin.edit:
            method: ['GET', 'POST']
            route: '/environments/:id/edit'
            stack: ['middleware.admin', 'environment.admin.edit.page']
            conditions: {id: %routes.regex.digit%}
