services:
    ######################################################################################################################
    # MIDDLEWARE
    ######################################################################################################################

    # Bounce unauthenticated api clients
    api.auth.bouncer:
        class: 'QL\Hal\Middleware\Bouncer\ApiAuthBouncer'
        arguments:
            - @service_container
            - @ldap
            - @doctrine.em

    middleware.cachedApi:
        class: 'QL\Hal\Middleware\CachedApiMiddleware'
        arguments:
            - @response.formatter
            - @slim.response

    middleware.requireEntity:
        class: 'QL\Hal\Middleware\RequireEntityMiddleware'
        arguments:
            - @service_container
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters

    middleware.login:
        class: 'QL\Hal\Middleware\ACL\LoginMiddleware'
        arguments:
            - @service_container
            - @doctrine.em
            - @session
            - @url
            - @slim.request
            - @logger.mcp.factory

    middleware.lead:
        class: 'QL\Hal\Middleware\ACL\LeadMiddleware'
        arguments:
            - @service_container
            - @middleware.login
            - @denied.twig
            - @permissions
            - @slim.halt

    middleware.admin:
        class: 'QL\Hal\Middleware\ACL\AdminMiddleware'
        arguments:
            - @service_container
            - @middleware.login
            - @denied.twig
            - @permissions
            - @slim.halt

    middleware.super:
        class: 'QL\Hal\Middleware\ACL\SuperMiddleware'
        arguments:
            - @service_container
            - @middleware.login
            - @denied.twig
            - @permissions
            - @slim.halt
