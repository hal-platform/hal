services:
    ######################################################################################################################
    # MIDDLEWARE
    ######################################################################################################################

    # Bounce unauthenticated users
    login.bouncer:
        class: 'QL\Hal\Middleware\Bouncer\LoginBouncer'
        arguments:
            - @session
            - @doctrine.em
            - @service_container
            - @url.helper
            - @slim.request

    # Bounce users who don't have access to modify a repository
    repoadmin.bouncer:
        class: 'QL\Hal\Middleware\Bouncer\RepoAdminBouncer'
        arguments:
            - @service_container
            - @permissions
            - @denied.twig
            - @login.bouncer
            - @doctrine.em
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters

    # Bounce unauthenticated api clients
    api.auth.bouncer:
        class: 'QL\Hal\Middleware\Bouncer\ApiAuthBouncer'
        arguments:
            - @service_container
            - @ldap
            - @doctrine.em

    middleware.cachedApi:
        class: 'QL\Hal\Middleware\CachedApiMiddleware'
        arguments:
            - @response.formatter
            - @slim.response

    middleware.requireEntity:
        class: 'QL\Hal\Middleware\RequireEntityMiddleware'
        arguments:
            - @service_container
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters

    middleware.login:
        class: 'QL\Hal\Middleware\ACL\LoginMiddleware'
        arguments:
            - @service_container
            - @doctrine.em
            - @session
            - @url
            - @slim.request

    middleware.admin:
        class: 'QL\Hal\Middleware\ACL\AdminMiddleware'
        arguments:
            - @service_container
            - @middleware.login
            - @denied.twig
            - @permissions.new
            - @slim.halt

    middleware.super:
        class: 'QL\Hal\Middleware\ACL\SuperMiddleware'
        arguments:
            - @service_container
            - @middleware.login
            - @denied.twig
            - @permissions.new
            - @slim.halt
