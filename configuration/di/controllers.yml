
# Application specific endpoints and controllers go here
# This includes handlers, middleware, or validators dedicated to a single page.
services:

    delete.confirm.page:
        parent: 'static.controller'
        arguments: [@delete.confirm.twig, @slim.response]
    delete.confirm.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['delete.confirm.twig']]]

    dashboard.page:
        class: 'QL\Hal\Controllers\DashboardController'
        arguments:
            - @dashboard.twig
            - @currentUser
            - @permissions
            - @clock
            - @doctrine.em
            - @json
        calls:
            - ['setCache', [@cache]]
            - ['setCacheTTL', [%cache.page.ttl%]]
    dashboard.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['dashboard.twig']]]

    login.page:
        class: 'QL\Hal\Controllers\LoginController'
        arguments:
            - @login.twig
            - @stats
    login.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['login.twig']]]
    login.handler:
        class: 'QL\Hal\Controllers\LoginHandler'
        arguments:
            - @twig.context
            - @ldap
            - @doctrine.em
            - @session
            - @url
            - @slim.request

    logout.handler:
        class: 'QL\Hal\Controllers\LogoutController'
        arguments: [@session, @url]

    ####################################################################################################################
    # QUEUE CONTROLLERS
    ####################################################################################################################

    queue.page:
        class: 'QL\Hal\Controllers\QueueController'
        arguments:
            - @queue.twig
            - @doctrine.em
    queue.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['queue.twig']]]

    queue.history.page:
        class: 'QL\Hal\Controllers\QueueHistoryController'
        arguments:
            - @queue.history.twig
            - @doctrine.em
            - @clock
            - @slim.route.parameters
            - %date.timezone%
    queue.history.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['queue.history.twig']]]

    ####################################################################################################################
    # GROUP CONTROLLERS
    ####################################################################################################################

    group.page:
        class: 'QL\Hal\Controllers\Group\GroupController'
        arguments:
            - @group.twig
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters
    group.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/group.twig']]]

    group.admin.add.page:
        class: 'QL\Hal\Controllers\Group\AddGroupController'
        arguments:
            - @group.admin.add.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
    group.admin.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/admin.add.twig']]]

    group.admin.edit.page:
        class: 'QL\Hal\Controllers\Group\EditGroupController'
        arguments:
            - @group.admin.edit.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    group.admin.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/admin.edit.twig']]]
    group.admin.remove.handler:
        class: 'QL\Hal\Controllers\Group\RemoveGroupController'
        arguments:
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ####################################################################################################################
    # BUILD CONTROLLERS
    ####################################################################################################################

    build.page:
        class: 'QL\Hal\Controllers\Build\BuildController'
        arguments:
            - @build.twig
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters
    build.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/build.twig']]]

    build.start.page:
        class: 'QL\Hal\Controllers\Build\StartBuildController'
        arguments:
            - @build.start.twig
            - @doctrine.em
            - @github
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    build.start.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/start.twig']]]

    build.start.handler:
        class: 'QL\Hal\Controllers\Build\StartBuildHandler'
        arguments:
            - @doctrine.em
            - @build.start.validator
            - @session
            - @url
            - @utility.id.generator
            - @twig.context
            - @slim.request
            - @sticky.environment
            - @slim.route.parameters
    build.start.validator:
        class: 'QL\Hal\Validator\BuildStartValidator'
        arguments:
            - @doctrine.em
            - @github
            - @permissions
            - @currentUser

    builds.page:
        class: 'QL\Hal\Controllers\Build\BuildsController'
        arguments:
            - @builds.twig
            - @doctrine.em
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    builds.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/builds.twig']]]

    ####################################################################################################################
    # PUSH CONTROLLERS
    ####################################################################################################################

    push.start.page:
        class: 'QL\Hal\Controllers\Push\StartPushController'
        arguments:
            - @push.start.twig
            - @doctrine.em
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    push.start.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/start.twig']]]

    push.start.handler:
        class: 'QL\Hal\Controllers\Push\StartPushHandler'
        arguments:
            - @session
            - @doctrine.em
            - @url
            - @currentUser
            - @permissions
            - @utility.id.generator
            - @slim.request
            - @twig.context
            - @sticky.environment
            - @slim.route.parameters

    push.rollback.page:
        class: 'QL\Hal\Controllers\Push\RollbackController'
        arguments:
            - @rollback.twig
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters
    rollback.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/rollback.twig']]]

    push.page:
        class: 'QL\Hal\Controllers\Push\PushController'
        arguments:
            - @push.twig
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters
    push.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/push.twig']]]

    pushes.page:
        class: 'QL\Hal\Controllers\Push\PushesController'
        arguments:
            - @pushes.twig
            - @doctrine.em
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    pushes.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/pushes.twig']]]

    ####################################################################################################################
    # ENVIRONMENT CONTROLLERS
    ####################################################################################################################

    environments.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentsController'
        arguments:
            - @environments.twig
            - @doctrine.em

    environments.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environments.twig']]]

    environment.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentController'
        arguments:
            - @environment.twig
            - @doctrine.em
            - @slim.not.found
            - @slim.route.parameters
    environment.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environment.twig']]]

    environment.admin.add.page:
        class: 'QL\Hal\Controllers\Environment\AddEnvironmentController'
        arguments:
            - @environment.admin.add.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
    environment.admin.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/admin.add.twig']]]

    environment.admin.edit.page:
        class: 'QL\Hal\Controllers\Environment\EditEnvironmentController'
        arguments:
            - @environment.admin.edit.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    environment.admin.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/admin.edit.twig']]]

    environment.admin.remove.handler:
        class: 'QL\Hal\Controllers\Environment\RemoveEnvironmentHandler'
        arguments:
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ####################################################################################################################
    # SERVER CONTROLLERS
    ####################################################################################################################

    servers.page:
        class: 'QL\Hal\Controllers\Server\ServersController'
        arguments:
            - @servers.twig
            - @doctrine.em
    servers.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/servers.twig']]]

    server.page:
        class: 'QL\Hal\Controllers\Server\ServerController'
        arguments:
            - @server.twig
            - @doctrine.em
            - @eb
            - @slim.not.found
            - @slim.route.parameters
    server.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/server.twig']]]

    server.admin.add.page:
        class: 'QL\Hal\Controllers\Server\AddServerController'
        arguments:
            - @server.admin.add.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
    server.admin.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/admin.add.twig']]]

    server.admin.edit.page:
        class: 'QL\Hal\Controllers\Server\EditServerController'
        arguments:
            - @server.admin.edit.twig
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters
    server.admin.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/admin.edit.twig']]]

    server.admin.remove.handler:
        class: 'QL\Hal\Controllers\Server\RemoveServerController'
        arguments:
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ####################################################################################################################
    # USER CONTROLLERS
    ####################################################################################################################

    user.page:
        class: 'QL\Hal\Controllers\User\UserController'
        arguments:
            - @user.twig
            - @hal.user
            - @doctrine.em
            - @ldap
            - @permissions
            - @json
        calls:
            - ['setCache', [@cache]]
            - ['setCacheTTL', [%cache.page.ttl%]]
    user.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/user.twig']]]

    users.page:
        class: 'QL\Hal\Controllers\User\UsersController'
        arguments:
            - @users.twig
            - @doctrine.em
    users.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/users.twig']]]

    user.settings.page:
        class: 'QL\Hal\Controllers\User\SettingsController'
        arguments:
            - @user.settings.twig
            - @doctrine.em
            - @currentUser
            - @slim.not.found
    user.settings.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/settings.twig']]]

    user.settings.handler:
        class: 'QL\Hal\Controllers\User\SettingsHandler'
        arguments:
            - @slim.cookies
            - @session
            - @url.helper
            - @name.helper
            - @currentUser
            - %cookie.preferences.ttl%
            - %navigation.list%
            - @slim.request

    ####################################################################################################################
    # USER TOKEN MANAGEMENT CONTROLLERS
    ####################################################################################################################

    user.token.add.handler:
        class: 'QL\Hal\Controllers\User\Token\AddTokenController'
        arguments:
            - @doctrine.em
            - @permissions
            - @currentUser
            - @session.flasher
            - @slim.request
            - @slim.not.found
            - @doctrine.random.id
            - @slim.route.parameters

    user.token.remove.handler:
        class: 'QL\Hal\Controllers\User\Token\RemoveTokenController'
        arguments:
            - @doctrine.em
            - @permissions
            - @currentUser
            - @session.flasher
            - @slim.not.found
            - @slim.route.parameters

    ####################################################################################################################
    # HELP CONTROLLERS
    ####################################################################################################################

    help.page:
        parent: 'static.controller'
        arguments: [@help.twig, @slim.response]
    help.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/help.twig']]]
    help.deployment.page:
        parent: 'static.controller'
        arguments: [@help.deployment.twig, @slim.response]
    help.deployment.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/deployment.twig']]]

    # help.api.page:
    #   parent: 'static.controller'
    #   arguments: [@help.api.twig, @slim.response]
    # help.api.twig:
    #   parent: 'twig.template'
    #   calls: [['setTemplate', ['help/api.twig']]]

    help.hal.page:
        parent: 'static.controller'
        arguments: [@help.hal.twig, @slim.response]
    help.hal.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/hal.twig']]]

    help.githubpermissions.page:
        parent: 'static.controller'
        arguments: [@help.githubpermissions.twig, @slim.response]
    help.githubpermissions.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/github-permissions.twig']]]


    ####################################################################################################################
    # GITHUB OAUTH CONTROLLERS
    ####################################################################################################################

    github.authorization.page:
        class: 'QL\Hal\Controllers\OAuth\GithubCallbackController'
        arguments:
            - @github.authorization.twig
            - @slim.request
            - @doctrine.em
            - @currentUser
            - @utilty.github.oauth
            - @session
            - @url
    github.authorization.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/github.token.error.twig']]]

    github.authorization.remove.page:
        class: 'QL\Hal\Controllers\User\RemoveGithubTokenController'
        arguments:
            - @github.authorization.remove.twig
            - @slim.request
            - @doctrine.em
            - @currentUser
            - @utilty.github.oauth
            - @session
            - @url
    github.authorization.remove.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/github.token.remove.twig']]]

    ####################################################################################################################
    # GENERAL USE CONTROLLERS
    ####################################################################################################################

    static.controller:
        class: 'QL\Hal\Controllers\StaticController'

    denied.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['denied.twig']]]

    # The twig template for slim errors (404, 500)
    error.pages.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['error.twig']]]

    debug.page:
        class: 'QL\Hal\Controllers\DebugController'
