# Application specific endpoints and controllers go here
# This includes handlers, middleware, or validators dedicated to a single page.
services:

    delete.confirm.page:
        parent: 'static.controller'
        arguments: ['@delete.confirm.twig', '@slim.response']
    delete.confirm.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['delete.confirm.twig']]]

    dashboard.page:
        class: 'QL\Hal\Controllers\DashboardController'
        arguments:
            - '@dashboard.twig'
            - '@currentUser'
            - '@permissions'
            - '@clock'
            - '@doctrine.em'
    dashboard.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['dashboard.twig']]]

    login.page:
        class: 'QL\Hal\Controllers\LoginController'
        arguments: ['@login.twig', '@stats']
    login.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['login.twig']]]
    login.handler:
        class: 'QL\Hal\Controllers\LoginHandler'
        arguments:
            - '@twig.context'
            - '@ldap'
            - '@doctrine.em'
            - '@session'
            - '@url'
            - '@doctrine.random'
            - '@slim.request'

    logout.handler:
        class: 'QL\Hal\Controllers\LogoutController'
        arguments: ['@session', '@url']

    latest.release.page:
        class: 'QL\Hal\Controllers\LatestReleaseController'
        arguments: ['@latest.release.twig']
    latest.release.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['latest-release.twig']]]

    ####################################################################################################################
    # QUEUE CONTROLLERS
    ####################################################################################################################

    queue.page:
        class: 'QL\Hal\Controllers\QueueController'
        arguments: ['@queue.twig', '@doctrine.em']
    queue.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['queue.twig']]]

    queue.history.page:
        class: 'QL\Hal\Controllers\QueueHistoryController'
        arguments:
            - '@queue.history.twig'
            - '@doctrine.em'
            - '@clock'
            - '@slim.route.parameters'
            - '%date.timezone%'
    queue.history.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['queue.history.twig']]]

    ####################################################################################################################
    # GROUP CONTROLLERS
    ####################################################################################################################

    group.page:
        class: 'QL\Hal\Controllers\Group\GroupController'
        arguments:
            - '@group.twig'
            - '@doctrine.em'
            - '@slim.not.found'
            - '@slim.route.parameters'
    group.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/group.twig']]]

    group.add.page:
        class: 'QL\Hal\Controllers\Group\AddGroupController'
        arguments:
            - '@group.add.twig'
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.request'
    group.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/group.add.twig']]]

    group.edit.page:
        class: 'QL\Hal\Controllers\Group\EditGroupController'
        arguments:
            - '@group.edit.twig'
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.request'
            - '@slim.not.found'
            - '@slim.route.parameters'
    group.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['group/group.edit.twig']]]
    group.remove.handler:
        class: 'QL\Hal\Controllers\Group\RemoveGroupController'
        arguments:
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.not.found'
            - '@slim.route.parameters'

    ####################################################################################################################
    # BUILD CONTROLLERS
    ####################################################################################################################

    build.page:
        class: 'QL\Hal\Controllers\Build\BuildController'
        arguments:
            - '@build.twig'
            - '@hal.build'
            - '@service.event_logs'
            - '@doctrine.em'
    build.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/build.twig']]]

    build.start.page:
        class: 'QL\Hal\Controllers\Build\StartBuildController'
        arguments:
            - '@build.start.twig'
            - '@doctrine.em'
            - '@github'
            - '@sticky.environment'
            - '@slim.request'
            - '@hal.application'
            - '@currentUser'
    build.start.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/start.twig']]]

    build.start.handler:
        class: 'QL\Hal\Controllers\Build\StartBuildHandler'
        arguments:
            - '@doctrine.em'
            - '@build.start.validator'
            - '@push.start.validator'
            - '@session.flasher'
            - '@twig.context'
            - '@slim.request'
            - '@sticky.environment'
            - '@hal.application'
    build.start.validator:
        class: 'QL\Hal\Validator\BuildStartValidator'
        arguments:
            - '@doctrine.em'
            - '@github'
            - '@permissions'
            - '@utility.id.generator'
            - '@currentUser'

    builds.page:
        class: 'QL\Hal\Controllers\Build\BuildsController'
        arguments:
            - '@builds.twig'
            - '@doctrine.em'
            - '@hal.application'
            - '@slim.request'
            - '@slim.not.found'
            - '@slim.route.parameters'
    builds.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['build/builds.twig']]]

    ####################################################################################################################
    # PUSH CONTROLLERS
    ####################################################################################################################

    push.start.page:
        class: 'QL\Hal\Controllers\Push\StartPushController'
        arguments:
            - '@push.start.twig'
            - '@doctrine.em'
            - '@pools'
            - '@slim.request'
            - '@slim.not.found'
            - '@slim.route.parameters'
    push.start.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/start.twig']]]

    push.start.handler:
        class: 'QL\Hal\Controllers\Push\StartPushHandler'
        arguments:
            - '@doctrine.em'
            - '@push.start.validator'
            - '@session'
            - '@url'
            - '@utility.id.generator'
            - '@slim.request'
            - '@twig.context'
            - '@sticky.environment'
            - '@slim.route.parameters'
    push.start.validator:
        class: 'QL\Hal\Validator\PushStartValidator'
        arguments:
            - '@doctrine.em'
            - '@permissions'
            - '@utility.id.generator'
            - '@currentUser'
            - '@doctrine.random'

    push.rollback.page:
        class: 'QL\Hal\Controllers\Push\RollbackController'
        arguments:
            - '@rollback.twig'
            - '@doctrine.em'
            - '@slim.not.found'
            - '@hal.application'
            - '@hal.deployment'
            - '@slim.route.parameters'
    rollback.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/rollback.twig']]]

    push.page:
        class: 'QL\Hal\Controllers\Push\PushController'
        arguments:
            - '@push.twig'
            - '@hal.push'
            - '@service.event_logs'
    push.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/push.twig']]]

    pushes.page:
        class: 'QL\Hal\Controllers\Push\PushesController'
        arguments:
            - '@pushes.twig'
            - '@doctrine.em'
            - '@hal.application'
            - '@slim.request'
            - '@slim.not.found'
            - '@slim.route.parameters'
    pushes.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['push/pushes.twig']]]

    ####################################################################################################################
    # ENVIRONMENT CONTROLLERS
    ####################################################################################################################

    environments.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentsController'
        arguments: ['@environments.twig', '@doctrine.em']

    environments.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environments.twig']]]

    environment.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentController'
        arguments:
            - '@environment.twig'
            - '@doctrine.em'
            - '@slim.not.found'
            - '@slim.route.parameters'
    environment.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environment.twig']]]

    environment.add.page:
        class: 'QL\Hal\Controllers\Environment\AddEnvironmentController'
        arguments:
            - '@environment.add.twig'
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.request'
    environment.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environment.add.twig']]]

    environment.edit.page:
        class: 'QL\Hal\Controllers\Environment\EditEnvironmentController'
        arguments:
            - '@environment.edit.twig'
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.request'
            - '@slim.not.found'
            - '@slim.route.parameters'
    environment.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['environment/environment.edit.twig']]]

    environment.remove.handler:
        class: 'QL\Hal\Controllers\Environment\RemoveEnvironmentHandler'
        arguments:
            - '@doctrine.em'
            - '@session.flasher'
            - '@slim.not.found'
            - '@slim.route.parameters'

    ####################################################################################################################
    # SERVER CONTROLLERS
    ####################################################################################################################

    servers.page:
        class: 'QL\Hal\Controllers\Server\ServersController'
        arguments: ['@servers.twig', '@doctrine.em']
    servers.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/servers.twig']]]

    server.page:
        class: 'QL\Hal\Controllers\Server\ServerController'
        arguments:
            - '@server.twig'
            - '@doctrine.em'
            - '@hal.server'
    server.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/server.twig']]]

    server.add.page:
        class: 'QL\Hal\Controllers\Server\AddServerController'
        arguments:
            - '@server.add.twig'
            - '@doctrine.em'
            - '@server.validator'
            - '@session.flasher'
            - '@slim.request'
    server.add.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/server.add.twig']]]

    server.edit.page:
        class: 'QL\Hal\Controllers\Server\EditServerController'
        arguments:
            - '@server.edit.twig'
            - '@doctrine.em'
            - '@server.validator'
            - '@session.flasher'
            - '@slim.request'
            - '@hal.server'
    server.edit.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['server/server.edit.twig']]]

    server.remove.handler:
        class: 'QL\Hal\Controllers\Server\RemoveServerController'
        arguments:
            - '@doctrine.em'
            - '@session.flasher'
            - '@hal.server'

    server.validator:
        class: 'QL\Hal\Validator\ServerValidator'
        arguments: ['@doctrine.em']

    ####################################################################################################################
    # USER CONTROLLERS
    ####################################################################################################################

    user.page:
        class: 'QL\Hal\Controllers\User\UserController'
        arguments:
            - '@user.twig'
            - '@hal.user'
            - '@doctrine.em'
            - '@ldap'
            - '@permissions'
            - '@json'
        calls:
            - ['setCache', ['@cache']]
            - ['setCacheTTL', ['%cache.page.ttl%']]
    user.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/user.twig']]]

    users.page:
        class: 'QL\Hal\Controllers\User\UsersController'
        arguments: ['@users.twig', '@doctrine.em']
    users.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/users.twig']]]

    user.settings.page:
        class: 'QL\Hal\Controllers\User\SettingsController'
        arguments: ['@user.settings.twig', '@currentUser']
    user.settings.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/settings.twig']]]

    user.settings.handler:
        class: 'QL\Hal\Controllers\User\SettingsHandler'
        arguments:
            - '@slim.cookies'
            - '@session.flasher'
            - '@utility.name.formatter'
            - '@currentUser'
            - '%cookie.preferences.ttl%'
            - '%navigation.list%'
            - '@slim.request'

    user.disable.handler:
        class: 'QL\Hal\Controllers\User\DisableUserHandler'
        arguments:
            - '@doctrine.em'
            - '@permissions'
            - '@session.flasher'
            - '@hal.user'

    user.enable.handler:
        class: 'QL\Hal\Controllers\User\EnableUserHandler'
        arguments:
            - '@doctrine.em'
            - '@session.flasher'
            - '@hal.user'

    ####################################################################################################################
    # USER TOKEN MANAGEMENT CONTROLLERS
    ####################################################################################################################

    user.token.add.handler:
        class: 'QL\Hal\Controllers\User\Token\AddTokenController'
        arguments:
            - '@doctrine.em'
            - '@permissions'
            - '@currentUser'
            - '@session.flasher'
            - '@slim.request'
            - '@slim.not.found'
            - '@doctrine.random'
            - '@slim.route.parameters'

    user.token.remove.handler:
        class: 'QL\Hal\Controllers\User\Token\RemoveTokenController'
        arguments:
            - '@doctrine.em'
            - '@permissions'
            - '@currentUser'
            - '@session.flasher'
            - '@slim.not.found'
            - '@slim.route.parameters'

    ####################################################################################################################
    # HELP CONTROLLERS
    ####################################################################################################################

    help.page:
        parent: 'static.controller'
        arguments: ['@help.twig', '@slim.response']
    help.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/help.twig']]]
    help.deployment.page:
        parent: 'static.controller'
        arguments: ['@help.deployment.twig', '@slim.response']
    help.deployment.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/deployment.twig']]]

    # help.api.page:
    #   parent: 'static.controller'
    #   arguments: [@help.api.twig, @slim.response]
    # help.api.twig:
    #   parent: 'twig.template'
    #   calls: [['setTemplate', ['help/api.twig']]]

    help.hal.page:
        parent: 'static.controller'
        arguments: ['@help.hal.twig', '@slim.response']
    help.hal.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/hal.twig']]]

    help.githubpermissions.page:
        parent: 'static.controller'
        arguments: ['@help.githubpermissions.twig', '@slim.response']
    help.githubpermissions.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/github-permissions.twig']]]


    ####################################################################################################################
    # GITHUB OAUTH CONTROLLERS
    ####################################################################################################################

    github.authorization.page:
        class: 'QL\Hal\Controllers\OAuth\GithubCallbackController'
        arguments:
            - '@github.authorization.twig'
            - '@slim.request'
            - '@doctrine.em'
            - '@currentUser'
            - '@github.oauth'
            - '@session'
            - '@url'
    github.authorization.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/github.token.error.twig']]]

    github.authorization.remove.page:
        class: 'QL\Hal\Controllers\User\RemoveGithubTokenController'
        arguments:
            - '@github.authorization.remove.twig'
            - '@slim.request'
            - '@doctrine.em'
            - '@currentUser'
            - '@github.oauth'
            - '@session'
            - '@url'
    github.authorization.remove.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['user/github.token.remove.twig']]]

    ####################################################################################################################
    # GENERAL USE CONTROLLERS
    ####################################################################################################################

    static.controller:
        class: 'QL\Hal\Controllers\StaticController'

    denied.twig:
        parent: 'twig.auto.template'
        calls: [['setTemplate', ['denied.twig']]]

    debug.page:
        class: 'QL\Hal\Controllers\DebugController'

    styleguide.page:
        parent: 'static.controller'
        arguments: ['@styleguide.twig', '@slim.response']
    styleguide.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['styleguide.html.twig']]]

