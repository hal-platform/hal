parameters:
    routes:

        dashboard:
            method: 'GET'
            route: '/'
            stack: ['middleware.signed_in', 'dashboard.page']

        # github.authorization:
        #     method: 'GET'
        #     route:  '/github-authorization'
        #     stack:  ['middleware.login', 'github.authorization.page']

        # github.authorization.remove:
        #     method: ['GET', 'POST']
        #     route:  '/settings/remove-github-authorization'
        #     stack:  ['middleware.login', 'github.authorization.remove.page']

        maintenance:
            method: 'GET'
            route:  '/maintenance.html'
            stack:  ['maintenance.page']

        denied:
            method: 'GET'
            route:  '/denied.html'
            stack:  ['denied.page']

        ####################################################################################################################
        # SIGN-IN CONTROLLERS
        ####################################################################################################################

        signin:
            method: ['GET', 'POST']
            route: '/signin'
            stack: ['signin.middleware', 'signin.page']
        signout:
            method: 'GET'
            route: '/signout'
            stack: ['signout.page']

        ################################################################################################################
        # HELP ROUTES
        ################################################################################################################

        latest.release:
            method: 'GET'
            route:  '/latest-release'
            stack:  ['latest_release.page']

        styleguide:
            route:  '/styleguide'
            stack:  ['styleguide.page']

        styleguide.icons:
            route:  '/styleguide/icons'
            stack:  ['styleguide.icons.page']

        help:
            method: 'GET'
            route: '/help'
            stack: ['help.page']

        help.scripting:
            method: 'GET'
            route: '/help/deployment-scripting'
            stack: ['help.deployment_scripting.page']

        help.setup:
            method: 'GET'
            route: '/help/application-setup'
            stack: ['help.application_setup.page']

        ################################################################################################################
        # USER ROUTES
        ################################################################################################################

        users.page1:
            method: 'GET'
            route: '/users'
            stack: ['middleware.signed_in', 'users.page']
        users:
            method: 'GET'
            route: '/users/page/{page:%r.digit%}'
            stack: ['middleware.signed_in', 'users.page']

        user.management:
            route: '/users/{user:%r.guid%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                user:
                    method: 'GET'
                    route: ''
                    stack: ['user.page']

                user.toggle:
                    method: 'POST'
                    route: '/toggle'
                    stack: ['middleware.is_admin', 'user.toggle.handler']

                token.management:
                    route: '/tokens'
                    stack: ['middleware.is_admin_or_self']
                    routes:
                        user.token.add:
                            method: 'POST'
                            route: '/add'
                            stack: ['user.token.add.handler']
                        user.token.remove:
                            method: ['GET', 'POST']
                            route: '/{token:%r.guid%}/revoke'
                            stack: ['middleware.nested_entity', 'middleware.removal_confirmation.token', 'user.token.remove.handler']

        settings:
            method: ['GET', 'POST']
            route: '/settings'
            stack: ['middleware.signed_in', 'user.settings.middleware', 'user.settings.page']

        settings.management:
            route: '/settings/favorite-applications/{application:%r.digit%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                settings.favorite_applications.add:
                    method: 'POST'
                    route: ''
                    stack: ['api_internal.settings.favorite_applications.add']
                settings.favorite_applications.remove:
                    method: 'POST'
                    route: '/remove'
                    stack: ['api_internal.settings.favorite_applications.remove']

        ################################################################################################################
        # ORGANIZATION ROUTES
        ################################################################################################################

        organization.add:
            method: ['GET', 'POST']
            route: '/organizations/add'
            stack: ['middleware.signed_in', 'organization.add.page']

        organization.management:
            route: '/organizations/{organization:%r.guid%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                organization:
                    method: 'GET'
                    route: ''
                    stack: ['organization.page']
                organization.edit:
                    method: ['GET', 'POST']
                    route: '/edit'
                    stack: ['middleware.is_admin', 'organization.edit.page']
                organization.remove:
                    method: ['GET', 'POST']
                    route: '/remove'
                    stack: ['middleware.is_admin', 'middleware.removal_confirmation.organization', 'organization.remove.handler']

        ################################################################################################################
        # APPLICATION ROUTES
        ################################################################################################################

        applications:
            method: 'GET'
            route: '/applications'
            stack: ['middleware.signed_in', 'applications.page']

        application.add:
            method: ['GET', 'POST']
            route: '/applications/add'
            stack: ['middleware.signed_in', 'application.add.page']

        application.management:
            route: '/applications/{application:%r.guid%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                application:
                    method: 'GET'
                    route: ''
                    stack: ['application.page']
                application.dashboard:
                    method: 'GET'
                    route: '/dashboard'
                    stack: ['application.dashboard.sticky_env.middleware', 'application.dashboard.page']

                application.edit:
                    method: ['GET', 'POST']
                    route: '/edit'
                    stack: ['middleware.is_owner', 'application.edit.page']
                application.remove:
                    method: ['GET', 'POST']
                    route: '/remove'
                    stack: ['middleware.is_owner', 'middleware.removal_confirmation.application', 'application.remove.handler']

                application_permission.add:
                    method: ['GET', 'POST']
                    route: '/permissions/add'
                    stack: ['middleware.is_owner', 'application.permission_add.page']

                application_permission.remove:
                    method: ['GET', 'POST']
                    route: '/permissions/remove'
                    stack: ['middleware.is_owner', 'application.permission_remove.page']

                # are these application routes or build/release routes?
                # It's nice to be able to use route groups to nest common url prefixes.

                build.start:
                    method: ['GET', 'POST']
                    route: '/build'
                    stack: ['middleware.signed_in', 'middleware.require_entity', 'build.start.middleware', 'build.start.page']

                build.history.page1:
                    method: 'GET'
                    route: '/builds'
                    stack: ['builds.page']
                build.history:
                    method: 'GET'
                    route: '/builds/{page:%r.digit%}'
                    stack: ['builds.page']

                release.history.page1:
                    method: 'GET'
                    route: '/releases'
                    stack: ['releases.page']
                release.history:
                    method: 'GET'
                    route: '/releases/page/{page:%r.digit%}'
                    stack: ['releases.page']

                targets:
                    method: 'GET'
                    route: '/targets'
                    stack: ['targets.page']
                target.add:
                    method: ['GET', 'POST']
                    route: '/targets/add'
                    stack: ['middleware.is_owner', 'target.add.middleware', 'target.add.page']

                target.management:
                    route: '/targets/{target:%r.digit%}'
                    stack: ['middleware.nested_entity']
                    routes:
                        target:
                            method: 'GET'
                            route: ''
                            stack: ['target.page']
                        target.edit:
                            method: ['GET', 'POST']
                            route: '/edit'
                            stack: ['middleware.is_owner', 'target.edit.middleware', 'target.edit.page']
                        target.remove:
                            method: ['GET', 'POST']
                            route: '/remove'
                            stack: ['middleware.is_owner', 'middleware.removal_confirmation.target', 'target.remove.handler']

                        rollback.page1:
                            method: 'GET'
                            route: '/releases'
                            stack: ['release.rollback.page']
                        rollback:
                            method: 'GET'
                            route: '/releases/page/{page:%r.digit%}'
                            stack: ['release.rollback.page']

                encrypted.configuration:
                    method: 'GET'
                    route: '/encrypted-configuration'
                    stack: ['encrypted.configuration.page']
                encrypted.add:
                    method: ['GET', 'POST']
                    route: '/encrypted-configuration/add'
                    stack: ['middleware.is_owner', 'encrypted.add.middleware', 'encrypted.add.page']

                encrypted.management:
                    route: '/encrypted-configuration/{encrypted:%r.guid%}'
                    stack: ['middleware.is_owner', 'middleware.nested_entity']
                    routes:
                        encrypted:
                            method: 'GET'
                            route: ''
                            stack: ['encrypted.page']
                        encrypted.remove:
                            method: ['GET', 'POST']
                            route: '/remove'
                            stack: ['middleware.removal_confirmation.encrypted', 'encrypted.remove.handler']

        ################################################################################################################
        # SERVER Routes
        ################################################################################################################

        servers:
            method: 'GET'
            route: '/servers'
            stack: ['middleware.signed_in', 'servers.page']

        server.add:
            method: ['GET', 'POST']
            route: '/servers/add'
            stack: ['middleware.is_admin', 'server.add.page']

        server.management:
            route: '/servers/{server:%r.digit%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                server:
                    method: 'GET'
                    route: ''
                    stack: ['server.page']
                server.edit:
                    method: ['GET', 'POST']
                    route: '/edit'
                    stack: ['middleware.is_admin', 'server.edit.page']
                server.remove:
                    method: ['GET', 'POST']
                    route: '/remove'
                    stack: ['middleware.is_admin', 'middleware.removal_confirmation.server', 'server.remove.handler']

        ################################################################################################################
        # ENVIRONMENT ROUTES
        ################################################################################################################

        environments:
            method: 'GET'
            route: '/environments'
            stack: ['middleware.signed_in', 'environments.page']

        environment.add:
            method: ['GET', 'POST']
            route: '/environments/add'
            stack: ['middleware.is_admin', 'environment.add.page']

        environment.management:
            route: '/environments/{environment:%r.guid%}'
            stack: ['middleware.signed_in', 'middleware.require_entity']
            routes:
                environment:
                    method: 'GET'
                    route: ''
                    stack: ['environment.page']
                environment.edit:
                    method: ['GET', 'POST']
                    route: '/edit'
                    stack: ['middleware.is_admin', 'environment.edit.page']
                environment.remove:
                    method: ['GET', 'POST']
                    route: '/remove'
                    stack: ['middleware.is_admin', 'middleware.removal_confirmation.environment', 'environment.remove.handler']

        ################################################################################################################
        # QUEUE ROUTES
        ################################################################################################################

        queue:
            method: 'GET'
            route: '/queue'
            stack: ['middleware.signed_in', 'queue.page']

        queue.history.page1:
            method: 'GET'
            route: '/queue-history'
            stack: ['middleware.signed_in', 'queue.history.page']

        queue.history:
            method: 'GET'
            route: '/queue-history/date/{date:%r.date%}'
            stack: ['middleware.signed_in', 'queue.history.page']

        ################################################################################################################
        # BUILD ROUTES
        ################################################################################################################

        build:
            method: 'GET'
            route: '/builds/{build:%r.build%}'
            stack: ['middleware.signed_in', 'middleware.require_entity', 'build.page']

        build.start:
            method: ['GET', 'POST']
            route: '/applications/{application:%r.digit%}/build[/environment/{environment:%r.digit%}]'
            stack: ['middleware.signed_in', 'middleware.require_entity', 'build.start.middleware', 'build.start.page']

        ################################################################################################################
        # Release ROUTES
        ################################################################################################################

        release:
            method: 'GET'
            route: '/releases/{release:%r.release%}'
            stack: ['middleware.signed_in', 'middleware.require_entity', 'release.page']

        release.start:
            method: ['GET', 'POST']
            route: '/builds/{build:%r.build%}/release'
            stack: ['middleware.signed_in', 'middleware.require_entity', 'release.start.middleware', 'release.start.page']

        ################################################################################################################
        # ADMIN ROUTES
        ################################################################################################################

        admin.management:
            route: '/admin'
            stack: ['middleware.is_admin']
            routes:
                admin:
                    method: 'GET'
                    route: ''
                    stack: ['admin.dashboard.page']

                admin.audit_history.page1:
                    method: 'GET'
                    route: '/audit-history'
                    stack: ['admin.audit_history.page']
                admin.audit_history:
                    method: 'GET'
                    route: '/audit-history/page/{page:%r.digit%}'
                    stack: ['admin.audit_history.page']

                ################################################################################################################
                # CREDENTIAL ROUTES
                ################################################################################################################

                credentials:
                    method: 'GET'
                    route: '/credentials'
                    stack: ['credentials.page']

                credential.add:
                    method: ['GET', 'POST']
                    route: '/credentials/add'
                    stack: ['middleware.is_super', 'credential.add.page']

                credential.management:
                    route: '/credentials/{credential:%r.guid%}'
                    stack: ['middleware.require_entity']
                    routes:
                        credential:
                            method: 'GET'
                            route: ''
                            stack: ['credential.page']

                        credential.edit:
                            method: ['GET', 'POST']
                            route: '/edit'
                            stack: ['credential.edit.page']

                        credential.remove:
                            method: ['GET', 'POST']
                            route: '/remove'
                            stack: ['middleware.is_super', 'middleware.removal_confirmation.credential', 'credential.remove.handler']

                ################################################################################################################
                # PERMISSION ROUTES
                ################################################################################################################

                admin.permissions:
                    method: 'GET'
                    route: '/permissions'
                    stack: ['admin.permissions.page']

                user_permissions.management:
                    route: '/users/{user:%r.guid%}'
                    stack: ['middleware.require_entity', 'middleware.nested_entity']
                    routes:
                        admin.permissions.refresh:
                            method: 'POST'
                            route: '/refresh'
                            stack: ['admin.permissions.refresh.handler']
                        admin.permissions.add:
                            method: ['GET', 'POST']
                            route: '/add'
                            stack: ['admin.permissions.add.page']
                        admin.permissions.type.remove:
                            method: ['GET', 'POST']
                            route: '/permission-type/{user_type:%r.guid%}/remove'
                            stack: ['admin.permissions.remove.middleware', 'admin.permissions.remove.handler']
                        admin.permissions.deployment.remove:
                            method: ['GET', 'POST']
                            route: '/permission-deployment/{user_permission:%r.guid%}/remove'
                            stack: ['admin.permissions.deployment.remove.middleware', 'admin.permissions.deployment.remove.handler']

        ################################################################################################################
        # SUPER ROUTES
        ################################################################################################################

        super.management:
            route: '/super'
            stack: ['middleware.is_super']
            routes:

                super.system:
                    method: 'GET'
                    route: '/system'
                    stack: ['super.system.page']
                super.system.agent:
                    method: 'GET'
                    route: '/system/{agent:%r.alphanum%}'
                    stack: ['super.system.page']

                super.caches:
                    method: ['GET', 'POST']
                    route: '/caches'
                    stack: ['super.caches.handler', 'super.caches.page']

                super.banner:
                    method: ['GET', 'POST']
                    route: '/banner'
                    stack: ['super.banner.page']
