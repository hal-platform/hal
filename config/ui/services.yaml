services:

    ####################################################################################################################
    # VALIDATORS
    ####################################################################################################################

    validator.organization:
        class: 'Hal\UI\Validator\OrganizationValidator'
        arguments: ['@doctrine.em']

    validator.environment:
        class: 'Hal\UI\Validator\EnvironmentValidator'
        arguments: ['@doctrine.em']

    validator.application:
        class: 'Hal\UI\Validator\ApplicationValidator'
        arguments: ['@doctrine.em', '@vcs']

    validator.credential:
        class: 'Hal\UI\Validator\CredentialValidator'
        arguments: ['@doctrine.em', '@encryption']

    validator.encrypted_property:
        class: 'Hal\UI\Validator\EncryptedPropertyValidator'
        arguments: ['@doctrine.em', '@encryption']

    validator.permissions:
        class: 'Hal\UI\Validator\PermissionsValidator'
        arguments: ['@doctrine.em']

    build.start.validator:
        class: 'Hal\UI\Validator\BuildValidator'
        arguments:
            - '@doctrine.em'
            - '@vcs'
            - '@service.authorization'
    release.start.validator:
        class: 'Hal\UI\Validator\ReleaseValidator'
        arguments:
            - '@doctrine.em'
            - '@service.authorization'

    target.validator:
        class: 'Hal\UI\Validator\TargetValidator'
        arguments:
            - '@doctrine.em'
            -
                cd: '@target.cd.validator'
                eb: '@target.eb.validator'
                rsync: '@target.rsync.validator'
                s3: '@target.s3.validator'
                script: '@target.script.validator'

    target.cd.validator:
        class: 'Hal\UI\Validator\Targets\CodeDeployValidator'
        arguments: ['@target.s3.validator']

    target.eb.validator:
        class: 'Hal\UI\Validator\Targets\ElasticBeanstalkValidator'
        arguments: ['@target.s3.validator']

    target.rsync.validator:
        class: 'Hal\UI\Validator\Targets\RSyncValidator'

    target.s3.validator:
        class: 'Hal\UI\Validator\Targets\S3Validator'

    target.script.validator:
        class: 'Hal\UI\Validator\Targets\ScriptValidator'

    meta.validator:
        class: 'Hal\UI\Validator\MetaValidator'

    ####################################################################################################################

    template.validator:
        class: 'Hal\UI\Validator\TargetTemplateValidator'
        arguments:
            - '@doctrine.em'
            -
                cd: '@template.cd.validator'
                eb: '@template.eb.validator'
                rsync: '@template.rsync.validator'
                s3: '@template.s3.validator'
                script: '@template.script.validator'

    template.cd.validator:
        class: 'Hal\UI\Validator\Targets\CodeDeployValidator'
        arguments: ['@template.s3.validator']
        calls:
            - ['withFlag', ['ALLOW_OPTIONAL']]

    template.eb.validator:
        class: 'Hal\UI\Validator\Targets\ElasticBeanstalkValidator'
        arguments: ['@template.s3.validator']
        calls:
            - ['withFlag', ['ALLOW_OPTIONAL']]

    template.rsync.validator:
        class: 'Hal\UI\Validator\Targets\RSyncValidator'
        calls:
            - ['withFlag', ['ALLOW_OPTIONAL']]

    template.s3.validator:
        class: 'Hal\UI\Validator\Targets\S3Validator'
        calls:
            - ['withFlag', ['ALLOW_OPTIONAL']]

    template.script.validator:
        class: 'Hal\UI\Validator\Targets\ScriptValidator'
        calls:
            - ['withFlag', ['ALLOW_OPTIONAL']]

    ####################################################################################################################

    user.validator:
        class: 'Hal\UI\Validator\UserValidator'
        arguments: ['@doctrine.em', '@clock']

    ####################################################################################################################
    # TWIG TEMPLATING
    ####################################################################################################################

    twig.extension.hal:
        class: 'Hal\UI\Twig\HalExtension'
        arguments:
            - '@utility.time.formatter'
            - '%gravatar.fallback%'

    twig.extension.github:
        class: 'Hal\UI\Twig\GitHubExtension'
        arguments: ['@vcs']
        calls:
            - ['setCache', ['@twig.extension.github.cache']]

    twig.extension.security:
        class: 'Hal\UI\Twig\SecurityExtension'
        arguments: ['@csrf']

    twig.extension.github.cache:
        parent: 'cache.memory'

    # Twig Environment
    twig.environment:
        parent: 'panthor.twig.environment'
        calls:
            - ['addExtension', ['@twig.extension.hal']]
            - ['addExtension', ['@twig.extension.github']]
            - ['addExtension', ['@twig.extension.security']]
            - ['addGlobal', ['application_title', '%application.title%']]
            - ['addGlobal', ['application_environment', '%application.environment%']]
            - ['addGlobal', ['application_sha', '%application.sha%']]
            - ['addGlobal', ['application_version', '%application.version%']]
            - ['addGlobal', ['hal_administrators_email', '%administrator_email%']]
