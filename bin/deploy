#!/usr/bin/env bash

set -e

DIR=$( cd "$( dirname "$0" )" && pwd )

# install and configure
"$DIR"/install
"$DIR"/config
"$DIR"/doctrine orm:generate:proxies
"$DIR"/dump-di
"$DIR"/gulp --deploy

# Remove artifacts from deployment - keep your builds tidy!

# Remove unneeded files if deploying from HAL
if [ -n "$HAL_ENVIRONMENT" ]; then
    DELFILES=(
        ".sass-cache"
        "node_modules"
        "bin/composer"
        "bin/sass"
        "bin/sass-convert"
        "bin/scss"
        "vendor/bundle"
        "js"
        "sass"
        "img"
        "tests"
    )

    # Remove files
    for i in ${DELFILES[@]}
    do
        FILE="$DIR/../$i"
        EXISTS=$(test -e $FILE && echo 1 || echo 0)
        if [[ $EXISTS -eq "1" ]]; then
            echo "Removing $FILE"
            rm -rf "$FILE"
        fi

    done
fi
