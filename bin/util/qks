#!/usr/bin/env php
<?php

namespace QL\Hal\Bin;

use QL\Kraken\Utility\QKSFactory;

if (!$container = @include __DIR__ . '/../../configuration/bootstrap.php') {
    echo "An error occured while retrieving DI container.\n";
    exit(1);
};

$baseURL = 'http://qkstest';
$clientID = 'derp';
$clientSecret = 'herp';
$sendingKey = 'ABCDEF';

$factory = $container->get('kraken.crypto.qks.factory');
$qmp = $factory->getQMP($baseURL, $clientID, $clientSecret, $sendingKey);

// For encrypting
$decrypted = '';
$recipients = ['ABCDEF'];

// For decrypting
$encrypted = '';

if ($decrypted) {
    echo str_repeat('=', 80) . "\n";
    echo "ENCRYPTING\n";
    echo str_repeat('=', 80) . "\n";

    $value = $qmp->encrypt($decrypted, $recipients);
    var_dump($value);

} elseif ($encrypted) {
    echo str_repeat('=', 80) . "\n";
    echo "DECRYPTING\n";
    echo str_repeat('=', 80) . "\n";

    $value = $qmp->decrypt($encrypted);
    var_dump($value);

} else {
    echo "Nothing to do.\n";
}

echo "\n";
