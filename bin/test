#!/usr/bin/env bash

set -e

DIR=$( cd "$( dirname "$0" )" && pwd )

BIN="$DIR/../vendor/bin/phpunit"
PARAMETERS=""
NO_SUITE="--testsuite none"
RAPID_CONFIG_FILE="--configuration $DIR/../testing/phpunit.rapid.xml"
CI_CONFIG_FILE="--configuration $DIR/../testing/phpunit.ci.xml"

STOP_SUITE=false

for var in "$@"
do
    if [ "$var" = "--rapid" ] ; then
        BIN="$BIN $RAPID_CONFIG_FILE"
    elif [ "$var" = "--coverage" ] ; then
        BIN="$BIN $CI_CONFIG_FILE"
    else
        PARAMETERS="$PARAMETERS $var"
    fi

    if [[ "${var:0:2}" != "--" ]] ; then
        STOP_SUITE=true
    fi
done

# if we think the user is targeting a file, remove the testsuite
if $STOP_SUITE; then
    BIN="$BIN $NO_SUITE"
fi

$BIN$PARAMETERS
