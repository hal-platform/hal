#!/usr/bin/env bash

set -e

DIR=$( cd "$( dirname "$0" )" && pwd )

COMPOSER="composer install --prefer-dist --dev"
NPM="npm install"
BUNDLER="bundle install"
SECRETGEN=""

# If deploying, use production settings
if [ -n "$HAL_ENVIRONMENT" ]; then
    COMPOSER="composer install --prefer-dist --no-interaction --ansi --no-dev --optimize-autoloader"
    NPM="npm install --production"
    BUNDLER="bundle install --frozen"
    SECRETGEN="$DIR/generate-encryption-secret"
fi

"$DIR/"$COMPOSER
$NPM

gem install bundler
$BUNDLER

$SECRETGEN
