# Application specific endpoints and controllers go here
services:


  hello.page:
    class: 'QL\Hal\Controllers\HelloController'
    arguments:
      - @hello.twig
      - @layout
      - @user
  hello.twig:
    parent: 'twig.template'
    arguments: ['hello.twig']

  login.page:
    class: 'QL\Hal\Controllers\LoginController'
    arguments: ['@login.twig']
  login.twig:
    parent: 'twig.template'
    arguments: ['login.twig']
  login.handle:
    class: 'QL\Hal\Controllers\LoginHandleController'
    arguments:
      - @login.twig
      - @ldapService
      - @user.repo
      - @doctrine.em
      - @session
      - @url.helper

  logout.handle:
    class: 'QL\Hal\Controllers\LogoutController'
    arguments: ['@session', '@url.helper']

  ######################################################################################################################
  # GROUP CONTROLLERS
  ######################################################################################################################

  groups.page:
    class: 'QL\Hal\Controllers\Group\GroupsController'
    arguments:
      - @groups.twig
      - @layout
      - @group.repo
  groups.twig:
    parent: 'twig.template'
    arguments: ['group/groups.twig']

  group.page:
    class: 'QL\Hal\Controllers\Group\GroupController'
    arguments:
      - @group.twig
      - @layout
      - @group.repo
      - @repository.repo
  group.twig:
    parent: 'twig.template'
    arguments: ['group/group.twig']

  group.admin.add.page:
    class: 'QL\Hal\Controllers\Group\AdminAddController'
    arguments:
      - @group.admin.add.twig
      - @layout
      - @group.repo
      - @doctrine.em
      - @session
      - @url.helper
  group.admin.add.twig:
    parent: 'twig.template'
    arguments:  ['group/admin.add.twig']
  group.admin.add.handle:
    parent: 'group.admin.add.page'

  group.admin.edit.page:
    class: 'QL\Hal\Controllers\Group\AdminEditController'
    arguments:
      - @group.admin.edit.twig
      - @layout
      - @group.repo
      - @doctrine.em
      - @session
      - @url.helper
  group.admin.edit.twig:
    parent: 'twig.template'
    arguments:  ['group/admin.edit.twig']
  group.admin.edit.handle:
    parent: 'group.admin.edit.page'
  group.admin.remove.handle:
    class: 'QL\Hal\Controllers\Group\AdminRemoveHandle'
    arguments:
      - @group.repo
      - @doctrine.em
      - @session
      - @url.helper


  ######################################################################################################################
  # REPOSITORY CONTROLLERS
  ######################################################################################################################

  repositories.page:
    class: 'QL\Hal\Controllers\Repository\RepositoriesController'
    arguments:
      - @repositories.twig
      - @layout
      - @repository.repo
  repositories.twig:
    parent: 'twig.template'
    arguments: ['repository/repositories.twig']

  repository.page:
    class: 'QL\Hal\Controllers\Repository\RepositoryController'
    arguments:
      - @repository.twig
      - @layout
      - @repository.repo
      - @deployment.repo
  repository.twig:
    parent: 'twig.template'
    arguments: ['repository/repository.twig']

  repository.status.page:
    class: 'QL\Hal\Controllers\Repository\RepositoryStatusController'
    arguments:
      - @repository.status.twig
      - @layout
      - @pushPermissionService
      - @doctrine.em
      - @repository.repo
      - @build.repo
      - @push.repo
      - @user
  repository.status.twig:
    parent: 'twig.template'
    arguments: ['repository/status.twig']

  repository.admin.add.page:
    class: 'QL\Hal\Controllers\Repository\AdminAddController'
    arguments:
      - @repository.admin.add.twig
      - @layout
      - @group.repo
      - @repository.repo
      - @doctrine.em
      - @github
      - @session
      - @url.helper
  repository.admin.add.twig:
    parent: 'twig.template'
    arguments: ['repository/admin.add.twig']
  repository.admin.add.handle:
    parent: 'repository.admin.add.page'

  repository.admin.edit.page:
    class: 'QL\Hal\Controllers\Repository\AdminEditController'
    arguments:
        - @repository.admin.edit.twig
        - @layout
        - @group.repo
        - @repository.repo
        - @doctrine.em
        - @session
        - @url.helper
  repository.admin.edit.twig:
    parent: 'twig.template'
    arguments: ['repository/admin.edit.twig']
  repository.admin.edit.handle:
    parent: 'repository.admin.edit.page'

  repository.admin.remove.handle:
    class: 'QL\Hal\Controllers\Repository\AdminRemoveHandle'
    arguments:
        - @repository.repo
        - @deployment.repo
        - @doctrine.em
        - @session
        - @url.helper

  ######################################################################################################################
  # ENVIRONMENT CONTROLLERS
  ######################################################################################################################

  environments.page:
    class: 'QL\Hal\Controllers\Environment\EnvironmentsController'
    arguments:
      - @environments.twig
      - @layout
      - @environment.repo
  environments.twig:
    parent: 'twig.template'
    arguments: ['environment/environments.twig']

  environment.page:
    class: 'QL\Hal\Controllers\Environment\EnvironmentController'
    arguments:
      - @environment.twig
      - @layout
      - @environment.repo
      - @server.repo
  environment.twig:
    parent: 'twig.template'
    arguments: ['environment/environment.twig']

  environment.admin.reorder.page:
    class: 'QL\Hal\Controllers\Environment\AdminReorderController'
    arguments:
      - @environment.admin.reorder.twig
      - @layout
      - @environment.repo
  environment.admin.reorder.twig:
    parent: 'twig.template'
    arguments: ['environment/admin.reorder.twig']
  environment.admin.reorder.handle:
    class: 'QL\Hal\Controllers\Environment\AdminReorderHandle'
    arguments:
      - @environment.repo
      - @doctrine.em
      - @session
      - @url.helper

  environment.admin.add.page:
    class: 'QL\Hal\Controllers\Environment\AdminAddController'
    arguments:
      - @environment.admin.add.twig
      - @layout
      - @environment.repo
      - @doctrine.em
      - @session
      - @url.helper
  environment.admin.add.twig:
    parent: 'twig.template'
    arguments: ['environment/admin.add.twig']
  environment.admin.add.handle:
    parent: environment.admin.add.page

  environment.admin.edit.page:
    class: 'QL\Hal\Controllers\Environment\AdminEditController'
    arguments:
      - @environment.admin.edit.twig
      - @layout
      - @environment.repo
      - @doctrine.em
      - @session
      - @url.helper
  environment.admin.edit.twig:
    parent: 'twig.template'
    arguments: ['environment/admin.edit.twig']
  environment.admin.edit.handle:
    parent: environment.admin.edit.page

  environment.admin.remove.handle:
    class: 'QL\Hal\Controllers\Environment\AdminRemoveHandle'
    arguments:
      - @environment.repo
      - @server.repo
      - @doctrine.em
      - @session
      - @url.helper

  ######################################################################################################################
  # SERVER CONTROLLERS
  ######################################################################################################################

  servers.page:
    class: 'QL\Hal\Controllers\Server\ServersController'
    arguments:
      - @servers.twig
      - @layout
      - @server.repo
  servers.twig:
    parent: 'twig.template'
    arguments: ['server/servers.twig']

  server.page:
    class: 'QL\Hal\Controllers\Server\ServerController'
    arguments:
      - @server.twig
      - @layout
      - @server.repo
      - @deployment.repo
  server.twig:
    parent: 'twig.template'
    arguments: ['server/server.twig']

  server.admin.add.page:
    class: 'QL\Hal\Controllers\Server\AdminAddController'
    arguments:
      - @server.admin.add.twig
      - @layout
      - @server.repo
      - @environment.repo
      - @doctrine.em
      - @session
      - @url.helper
  server.admin.add.twig:
    parent: 'twig.template'
    arguments: ['server/admin.add.twig']
  server.admin.add.handle:
    parent: 'server.admin.add.page'

  server.admin.edit.page:
    class: 'QL\Hal\Controllers\Server\AdminEditController'
    arguments:
      - @server.admin.edit.twig
      - @layout
      - @server.repo
      - @environment.repo
      - @doctrine.em
      - @session
      - @url.helper
  server.admin.edit.twig:
    parent: 'twig.template'
    arguments: ['server/admin.edit.twig']
  server.admin.edit.handle:
    parent: 'server.admin.edit.page'

  server.admin.remove.handle:
    class: 'QL\Hal\Controllers\Server\AdminRemoveHandle'
    arguments:
      - @server.repo
      - @deployment.repo
      - @doctrine.em
      - @session
      - @url.helper

  ######################################################################################################################
  # USER CONTROLLERS
  ######################################################################################################################

  user.page:
    class: 'QL\Hal\Controllers\User\UserController'
    arguments:
      - @user.twig
      - @layout
      - @pushPermissionService
      - @ldapService
      - @user.repo
      - @user
      - @doctrine.em
  user.twig:
    parent: 'twig.template'
    arguments:
      - 'user/user.twig'

  users.page:
    class: 'QL\Hal\Controllers\User\UsersController'
    arguments:
      - @users.twig
      - @layout
      - @user.repo
  users.twig:
    parent: 'twig.template'
    arguments:
      - 'user/users.twig'

  user.edit.page:
    class: 'QL\Hal\Controllers\User\EditController'
    arguments:
      - @user.edit.twig
      - @layout
      - @pushPermissionService
      - @ldapService
      - @user.repo
      - @doctrine.em
      - @url.helper
      - @user
  user.edit.twig:
    parent: 'twig.template'
    arguments:
      - 'user/user.edit.twig'
  user.edit.handle:
    class: 'QL\Hal\Controllers\User\EditHandle'
    arguments:
      - @user.repo
      - @url.helper

  ######################################################################################################################
  # ADMIN CONTROLLERS
  ######################################################################################################################

  admin.dashboard.page:
    parent: 'static.controller'
    arguments: ['@admin.dashboard.twig']
  admin.dashboard.twig:
    parent: 'twig.template'
    arguments: ['admin/dashboard.twig']

  ######################################################################################################################
  # API CONTROLLERS
  ######################################################################################################################

  api.github.users:
    class: 'QL\Hal\Github\UsersApi'
    arguments: ['@github']

  api.github.user.repositories:
    class: 'QL\Hal\Github\ReposApi'
    arguments: ['@github']

  api.github.user.repository.pullrequests:
    class: 'QL\Hal\Github\PullRequestsApi'
    arguments: ['@github']

  ######################################################################################################################
  # GENERAL USE CONTROLLERS
  ######################################################################################################################

  static.controller:
    class: 'QL\Hal\Controllers\StaticController'

  denied.page:
    parent: 'static.controller'
    arguments: ['@denied.twig', 403]
  denied.twig:
    parent: 'twig.template'
    arguments: ['denied.html.twig']

  # TEMP
  nyi.page:
    class: 'QL\Hal\Controllers\NyiController'
    arguments: ['@nyi.twig']
  nyi.twig:
    parent: 'twig.template'
    arguments: ['nyi.twig']

  # The twig template for slim errors (404, 500)
  error.pages.twig:
    parent: 'twig.template'
    arguments: ['error.html.twig']
