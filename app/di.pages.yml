# Application specific endpoints and controllers go here
# This includes handlers, middleware, or validators dedicated to a single page.
services:

    delete.confirm.page:
        parent: 'static.controller'
        arguments: [@delete.confirm.twig, @slim.response]
    delete.confirm.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['delete.confirm.twig']]]

    dashboard.page:
        class: 'QL\Hal\Controllers\DashboardController'
        arguments:
            - @dashboard.twig
            - @currentUser
            - @permissions
            - @build.repo
            - @push.repo
            - @user.repo
            - @slim.response
    dashboard.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['dashboard.twig']]]

    login.page:
        class: 'QL\Hal\Controllers\LoginController'
        arguments: [@login.twig, @slim.response]
    login.twig:
        parent: 'twig.template'
        arguments: ['login.twig']
        calls: [['setTemplate', ['login.twig']]]
    login.handler:
        class: 'QL\Hal\Controllers\LoginHandler'
        arguments:
            - @twig.context
            - @ldap
            - @user.repo
            - @doctrine.em
            - @session
            - @url
            - @slim.request

    logout.handler:
        class: 'QL\Hal\Controllers\LogoutController'
        arguments: [@session, @url]

    queue.page:
        class: 'QL\Hal\Controllers\QueueController'
        arguments:
            - @queue.twig
            - @build.repo
            - @push.repo
            - @slim.response
    queue.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['queue.twig']]]

    ######################################################################################################################
    # GROUP CONTROLLERS
    ######################################################################################################################

    groups.page:
        class: 'QL\Hal\Controllers\Group\GroupsController'
        arguments:
            - @groups.twig
            - @group.repo
            - @slim.response
    groups.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['group/groups.twig']]]

    group.page:
        class: 'QL\Hal\Controllers\Group\GroupController'
        arguments:
            - @group.twig
            - @group.repo
            - @repository.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    group.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['group/group.twig']]]

    group.admin.add.page:
        class: 'QL\Hal\Controllers\Group\AddGroupController'
        arguments:
            - @group.admin.add.twig
            - @group.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
    group.admin.add.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['group/admin.add.twig']]]

    group.admin.edit.page:
        class: 'QL\Hal\Controllers\Group\EditGroupController'
        arguments:
            - @group.admin.edit.twig
            - @group.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    group.admin.edit.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['group/admin.edit.twig']]]
    group.admin.remove.handler:
        class: 'QL\Hal\Controllers\Group\RemoveGroupController'
        arguments:
            - @group.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ######################################################################################################################
    # REPOSITORY CONTROLLERS
    ######################################################################################################################

    repositories.page:
        class: 'QL\Hal\Controllers\Repository\RepositoriesController'
        arguments:
            - @repositories.twig
            - @group.repo
            - @slim.response
    repositories.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/repositories.twig']]]

    repository.page:
        class: 'QL\Hal\Controllers\Repository\RepositoryController'
        arguments:
            - @repository.twig
            - @repository.repo
            - @deployment.repo
            - @permissions
            - @eb
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/repository.twig']]]

    repository.status.page:
        class: 'QL\Hal\Controllers\Repository\RepositoryStatusController'
        arguments:
            - @repository.status.twig
            - @repository.repo
            - @build.repo
            - @deployment.repo
            - @push.repo
            - @environment.repo
            - @sticky.environment
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.status.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/status.twig']]]

    repository.status.sticky.handler:
        class: 'QL\Hal\Controllers\Repository\RepositoryStatusEnvironmentSaveHandler'
        arguments:
            - @environment.repo
            - @slim.request
            - @url
            - @sticky.environment
            - @slim.route.parameters

    repository.admin.add.page:
        class: 'QL\Hal\Controllers\Repository\AddRepositoryController'
        arguments:
            - @repository.admin.add.twig
            - @group.repo
            - @repository.repo
            - @doctrine.em
            - @github
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
    repository.admin.add.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/admin.add.twig']]]

    repository.admin.edit.page:
        class: 'QL\Hal\Controllers\Repository\EditRepositoryController'
        arguments:
            - @repository.admin.edit.twig
            - @group.repo
            - @repository.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.admin.edit.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/admin.edit.twig']]]

    repository.admin.remove.handler:
        class: 'QL\Hal\Controllers\Repository\RemoveRepositoryController'
        arguments:
            - @repository.repo
            - @deployment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ######################################################################################################################
    # REPOSITORY DEPLOYMENT CONTROLLERS
    ######################################################################################################################

    repository.deployment.page:
        class: 'QL\Hal\Controllers\Repository\Deployment\DeploymentController'
        arguments:
            - @repository.deployment.twig
            - @repository.repo
            - @deployment.repo
            - @eb
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.deployment.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/deployment.twig']]]

    repository.deployments.page:
        class: 'QL\Hal\Controllers\Repository\Deployment\DeploymentsController'
        arguments:
            - @repository.deployments.twig
            - @environment.repo
            - @server.repo
            - @repository.repo
            - @deployment.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.deployments.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/deployments.twig']]]

    repository.deployments.add.page:
        class: 'QL\Hal\Controllers\Repository\Deployment\AddDeploymentController'
        arguments:
            - @repository.deployments.add.twig
            - @server.repo
            - @repository.repo
            - @url
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.deployments.add.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/deployments.add.twig']]]

    repository.deployments.add.handler:
        class: 'QL\Hal\Controllers\Repository\Deployment\AddDeploymentHandler'
        arguments:
            - @slim.request
            - @repository.deployments.add.handler.form
            - @repository.deployments.add.handler.json
    repository.deployments.add.handler.form:
        class: 'QL\Hal\Controllers\Repository\Deployment\AddDeploymentFormHandler'
        arguments:
            - @doctrine.em
            - @repository.deployment.validator
            - @session
            - @url
            - @twig.context
            - @slim.request
            - @slim.route.parameters
    repository.deployments.add.handler.json:
        class: 'QL\Hal\Controllers\Repository\Deployment\AddDeploymentJsonHandler'
        arguments:
            - @doctrine.em
            - @repository.deployment.validator
            - @slim.halt
            - @json
            - @url
            - @slim.request
            - @slim.response
            - @slim.route.parameters
    repository.deployment.validator:
        class: 'QL\Hal\Validator\DeploymentValidator'
        arguments:
            - @repository.repo
            - @server.repo
            - @deployment.repo

    repository.deployment.edit.page:
        class: 'QL\Hal\Controllers\Repository\Deployment\EditDeploymentController'
        arguments:
            - @repository.deployment.edit.twig
            - @repository.repo
            - @deployment.repo
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    repository.deployment.edit.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['repository/deployments.edit.twig']]]
    repository.deployment.edit.handler:
        class: 'QL\Hal\Controllers\Repository\Deployment\EditDeploymentHandler'
        arguments:
            - @doctrine.em
            - @deployment.repo
            - @repository.deployment.validator
            - @session
            - @url
            - @twig.context
            - @slim.request
            - @slim.route.parameters

    repository.deployments.remove.handler:
        class: 'QL\Hal\Controllers\Repository\Deployment\RemoveDeploymentHandler'
        arguments:
            - @deployment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters

    ######################################################################################################################
    # BUILD CONTROLLERS
    #####################################################################################################################

    build.page:
        class: 'QL\Hal\Controllers\Build\BuildController'
        arguments:
            - @build.twig
            - @build.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    build.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['build/build.twig']]]

    build.start.page:
        class: 'QL\Hal\Controllers\Build\StartBuildController'
        arguments:
            - @build.start.twig
            - @repository.repo
            - @environment.repo
            - @github
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    build.start.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['build/start.twig']]]

    build.start.handler:
        class: 'QL\Hal\Controllers\Build\StartBuildHandler'
        arguments:
            - @build.repo
            - @doctrine.em
            - @build.start.validator
            - @session
            - @url
            - @utility.id.generator
            - @twig.context
            - @slim.request
            - @sticky.environment
            - @slim.route.parameters
    build.start.validator:
        class: 'QL\Hal\Validator\BuildStartValidator'
        arguments:
            - @repository.repo
            - @environment.repo
            - @github
            - @permissions
            - @currentUser

    builds.page:
        class: 'QL\Hal\Controllers\Build\BuildsController'
        arguments:
            - @builds.twig
            - @repository.repo
            - @build.repo
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    builds.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['build/builds.twig']]]

    ######################################################################################################################
    # PUSH CONTROLLERS
    ######################################################################################################################

    push.start.page:
        class: 'QL\Hal\Controllers\Push\StartPushController'
        arguments:
            - @push.start.twig
            - @build.repo
            - @deployment.repo
            - @server.repo
            - @push.repo
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    push.start.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['push/start.twig']]]

    push.start.handler:
        class: 'QL\Hal\Controllers\Push\StartPushHandler'
        arguments:
            - @session
            - @build.repo
            - @push.repo
            - @deployment.repo
            - @user.repo
            - @doctrine.em
            - @url
            - @currentUser
            - @permissions
            - @utility.id.generator
            - @slim.request
            - @twig.context
            - @sticky.environment
            - @slim.route.parameters

    push.rollback.page:
        class: 'QL\Hal\Controllers\Push\RollbackController'
        arguments:
            - @rollback.twig
            - @repository.repo
            - @deployment.repo
            - @push.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    rollback.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['push/rollback.twig']]]

    push.page:
        class: 'QL\Hal\Controllers\Push\PushController'
        arguments:
            - @push.twig
            - @push.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    push.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['push/push.twig']]]

    pushes.page:
        class: 'QL\Hal\Controllers\Push\PushesController'
        arguments:
            - @pushes.twig
            - @repository.repo
            - @push.repo
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    pushes.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['push/pushes.twig']]]

    ######################################################################################################################
    # ENVIRONMENT CONTROLLERS
    ######################################################################################################################

    environments.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentsController'
        arguments:
            - @environments.twig
            - @environment.repo
            - @slim.response

    environments.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['environment/environments.twig']]]

    environment.page:
        class: 'QL\Hal\Controllers\Environment\EnvironmentController'
        arguments:
            - @environment.twig
            - @environment.repo
            - @server.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    environment.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['environment/environment.twig']]]

    environment.admin.reorder.page:
        class: 'QL\Hal\Controllers\Environment\ReorderEnvironmentsController'
        arguments:
            - @environment.admin.reorder.twig
            - @environment.repo
            - @slim.response
            - @slim.not.found
    environment.admin.reorder.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['environment/admin.reorder.twig']]]
    environment.admin.reorder.handler:
        class: 'QL\Hal\Controllers\Environment\ReorderEnvironmentsHandler'
        arguments:
            - @environment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.not.found
            - @twig.context

    environment.admin.add.page:
        class: 'QL\Hal\Controllers\Environment\AddEnvironmentController'
        arguments:
            - @environment.admin.add.twig
            - @environment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
    environment.admin.add.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['environment/admin.add.twig']]]

    environment.admin.edit.page:
        class: 'QL\Hal\Controllers\Environment\EditEnvironmentController'
        arguments:
            - @environment.admin.edit.twig
            - @environment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    environment.admin.edit.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['environment/admin.edit.twig']]]

    environment.admin.remove.handler:
        class: 'QL\Hal\Controllers\Environment\RemoveEnvironmentHandler'
        arguments:
            - @environment.repo
            - @server.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters
    ######################################################################################################################
    # SERVER CONTROLLERS
    ######################################################################################################################

    servers.page:
        class: 'QL\Hal\Controllers\Server\ServersController'
        arguments:
            - @servers.twig
            - @server.repo
            - @slim.response
    servers.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['server/servers.twig']]]

    server.page:
        class: 'QL\Hal\Controllers\Server\ServerController'
        arguments:
            - @server.twig
            - @server.repo
            - @deployment.repo
            - @eb
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    server.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['server/server.twig']]]

    server.admin.add.page:
        class: 'QL\Hal\Controllers\Server\AddServerController'
        arguments:
            - @server.admin.add.twig
            - @server.repo
            - @environment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
    server.admin.add.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['server/admin.add.twig']]]

    server.admin.edit.page:
        class: 'QL\Hal\Controllers\Server\EditServerController'
        arguments:
            - @server.admin.edit.twig
            - @server.repo
            - @environment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    server.admin.edit.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['server/admin.edit.twig']]]

    server.admin.remove.handler:
        class: 'QL\Hal\Controllers\Server\RemoveServerController'
        arguments:
            - @server.repo
            - @deployment.repo
            - @doctrine.em
            - @session
            - @url.helper
            - @slim.not.found
            - @slim.route.parameters
    ######################################################################################################################
    # USER CONTROLLERS
    ######################################################################################################################

    user.page:
        class: 'QL\Hal\Controllers\User\UserController'
        arguments:
            - @user.twig
            - @ldap
            - @user.repo
            - @permissions
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    user.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['user/user.twig']]]

    users.page:
        class: 'QL\Hal\Controllers\User\UsersController'
        arguments:
            - @users.twig
            - @user.repo
            - @slim.response
    users.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['user/users.twig']]]

    user.settings.page:
        class: 'QL\Hal\Controllers\User\SettingsController'
        arguments:
            - @user.settings.twig
            - @user.repo
            - @currentUser
            - @slim.response
            - @slim.not.found
    user.settings.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['user/settings.twig']]]

    user.settings.handler:
        class: 'QL\Hal\Controllers\User\SettingsHandler'
        arguments:
            - @slim.cookies
            - @session
            - @url.helper
            - @name.helper
            - @currentUser
            - %cookie.preferences.ttl%
            - %navigation.list%
            - @slim.request

    ######################################################################################################################
    # USER TOKEN MANAGEMENT CONTROLLERS
    ######################################################################################################################

    user.token.add.handler:
        class: 'QL\Hal\Controllers\User\Token\AddTokenController'
        arguments:
            - @doctrine.em
            - @user.repo
            - @url.helper
            - @permissions
            - @currentUser
            - @slim.request
            - @slim.not.found
            - @slim.route.parameters

    user.token.remove.handler:
        class: 'QL\Hal\Controllers\User\Token\RemoveTokenController'
        arguments:
            - @doctrine.em
            - @token.repo
            - @url.helper
            - @permissions
            - @currentUser
            - @slim.not.found
            - @slim.route.parameters
    ######################################################################################################################
    # ADMIN CONTROLLERS
    ######################################################################################################################

    admin.dashboard.page:
        class: 'QL\Hal\Controllers\Admin\DashboardController'
        arguments: [@admin.dashboard.twig, @slim.response]
    admin.dashboard.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['admin/dashboard.twig']]]

    admin.super.page:
        class: 'QL\Hal\Controllers\Admin\SuperController'
        arguments:
            - @admin.super.twig
            - @slim.response
            - %encryption.secret%
            - %session.encryption.secret%
            - @hal.pushfile
    admin.super.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['admin/super.twig']]]

    admin.users.page:
        class: 'QL\Hal\Controllers\Admin\UserManagementController'
        arguments:
            - @admin.users.twig
            - @user.repo
            - @ldap
            - @doctrine.em
            - @slim.request
            - @slim.response
    admin.users.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['admin/users.management.twig']]]

    admin.caches.page:
        class: 'QL\Hal\Controllers\Admin\CacheManagementController'
        arguments:
            - @admin.caches.twig
            - @doctrine.config
            - @redis
            - @slim.request
            - @slim.response
    admin.caches.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['admin/cache.management.twig']]]

    admin.message.page:
        class: 'QL\Hal\Controllers\Admin\GlobalMessageController'
        arguments:
            - @admin.message.twig
            - @global.message
            - @session
            - @url.helper
            - @slim.request
            - @slim.response
    admin.message.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['admin/global.message.twig']]]

    ######################################################################################################################
    # HELP CONTROLLERS
    ######################################################################################################################

    help.page:
        parent: 'static.controller'
        arguments: [@help.twig, @slim.response]
    help.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/help.twig']]]
    help.deployment.page:
        parent: 'static.controller'
        arguments: [@help.deployment.twig, @slim.response]
    help.deployment.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/deployment.twig']]]

    # help.api.page:
    #   parent: 'static.controller'
    #   arguments: [@help.api.twig, @slim.response]
    # help.api.twig:
    #   parent: 'twig.template'
    #   calls: [['setTemplate', ['help/api.twig']]]

    help.hal.page:
        parent: 'static.controller'
        arguments: [@help.hal.twig, @slim.response]
    help.hal.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['help/hal.twig']]]

    ######################################################################################################################
    # GENERAL USE CONTROLLERS
    ######################################################################################################################

    static.controller:
        class: 'QL\Hal\Controllers\StaticController'

    denied.page:
        parent: 'static.controller'
        arguments: [@denied.twig, @slim.response, 403]
    denied.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['denied.twig']]]

    audit.logs.page:
        class: 'QL\Hal\Controllers\AuditLogsController'
        arguments:
            - @audit.logs.twig
            - @audit.log.repo
            - @slim.response
            - @slim.not.found
            - @slim.route.parameters
    audit.logs.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['audit.logs.twig']]]

    # The twig template for slim errors (404, 500)
    error.pages.twig:
        parent: 'twig.template'
        calls: [['setTemplate', ['error.twig']]]

    debug.page:
        class: 'QL\Hal\Controllers\DebugController'
