{% extends 'base.html.twig' %}

{% set page_title = "Start Build: " ~ repo.description %}

{% block content %}

    <h2>Create a new build for <strong>{{ repo.description }}</strong></h2>

    <p><a class="btn--small btn--back" href="{{ urlFor('repository.status', {'id': repo.id}) }}">Back to Repository status</a></p>

    <form method="post" action="{{ urlFor('build.handle', {'id': repo.id}) }}" name="start-build">

    <h3>Choose what environment to build for:</h3>
    <ul class="check-list radio-grid radio-grid__env">
    {% for env in environments %}
        <li>
            <input id="env-{{ env.key }}" type="radio" name="environment" value="{{ env.key }}">
            <label for="env-{{ env.key }}">{{ env.key }}</label>
        </li>
    {% endfor %}
    </ul>

    <h3>Choose what to build:</h3>
    <p class="js-error"></p>
    <ul class="form-fields">
        <li class="mbn">
            <label for="search">Search for a Branch, Tag, Pull Request, or enter a Commit ID.</label>
            <input class="text-input js-search-input" type="text" id="search" name="search" autocomplete="off">
        </li>
    </ul>

    <div class="drop-down js-search-drop">
        <ul class="list--bare js-search-results">
            <!-- search results go here -->
        </ul>
    </div>

    <div class="leader"><input class="btn btn--action" type="submit" value="Start Build" name="submit"></div>

      <ul class="nav tabs js-tabs">
          <li class="active">
              <a name="js-tab1">
                  <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#branch"></use></svg>
                  <span class="tab-text">Branches</span>
              </a>
          </li>
          <li>
              <a name="js-tab2">
                  <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#tag"></use></svg>
                  <span class="tab-text">Tags</span>
              </a>
          </li>
          <li>
              <a name="js-tab3">
                  <svg class="icon open" viewBox="0 0 32 32"><use xlink:href="#pull"></use></svg>
                  <span class="tab-text">Open Pull Requests</span>
              </a>
          </li>
          <li>
              <a name="js-tab4">
                  <svg class="icon closed" viewBox="0 0 32 32"><use xlink:href="#pull"></use></svg>
                  <span class="tab-text">Closed Pull Requests</span>
              </a>
          </li>
      </ul>

    <div class="tab-content js-tab-content">
      <div data-id="js-tab1" class="tab js-tab-active js-tab1">
        <ul data-type="branch" class="check-list js-search-list radio-grid">
        {% for branch in branches %}
            <li>
                <input id="{{ branch.object.sha }}-{{ branch.name }}" data-search="{{ branch.name }}" type="radio" name="reference" value="{{ branch.name }}">
                <label for="{{ branch.object.sha }}-{{ branch.name }}" title="{{ branch.name }}">
                    <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#branch"></use></svg>
                    {{ branch.name }} <br />

                    <a href="{{ githubTreeish(repo.GithubUser, repo.GithubRepo, branch.name) }}">{{ branch.object.sha|commit }}</a>
                    <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#github"></use></svg>
                </label>
            </li>
        {% else %}
            <li class="full">There are no branches.</li>
        {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab2" class="tab js-tab2">
        <ul data-type="tag" class="check-list js-search-list radio-grid">
        {% for tag in tags %}
            <li>
                <input id="{{ tag.object.sha }}-{{ tag.name }}" data-search="{{ tag.name }}" type="radio" name="reference" value="tag/{{ tag.name }}">
                <label for="{{ tag.object.sha }}-{{ tag.name }}">
                    <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#tag"></use></svg>
                    {{ tag.name }} <br />

                    <a href="{{ githubRelease(repo.GithubUser, repo.GithubRepo, tag.name) }}">{{ tag.object.sha|commit }}</a>
                    <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#github"></use></svg>
                </label>
            </li>
        {% else %}
            <li class="full">There are no tags.</li>
        {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab3" class="tab js-tab3">
        <ul data-type="pull" class="check-list js-search-list radio-grid">
            {% for pull in pulls %}
                <li class="pr-selection">
                    <input id="pr{{ pull.number }}" data-search="{{ pull.number }}" data-status="{{ pull.state }}" type="radio" name="reference" value="pull/{{ pull.number }}">
                    <label for="pr{{ pull.number }}" title="{{ pull.title }}">
                        <svg class="icon {{ pull.state }}" viewBox="0 0 32 32"><use xlink:href="#pull"></use></svg>
                        <span class="js-title">{{ pull.title }}</span>
                        <br />

                        <a href="{{ githubPullRequest(repo.githubUser, repo.githubRepo, pull.number) }}">PR #{{ pull.number }}</a>
                        <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#github"></use></svg>
                        <br />

                        <span class="pr-smtxt">From <span class="pr-label">{{ pull.head.user.login }}:{{ pull.head.ref }}</span><br />to <span class="pr-label">{{ pull.base.ref }}</span></span>
                    </label>
                </li>
            {% else %}
                <li class="full">There are no open pull requests.</li>
            {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab4" class="tab js-tab4">
        <ul data-type="pull" class="check-list js-search-list radio-grid">
            {% for pull in closed_pulls %}
                <li class="pr-selection">
                    <input id="pr{{ pull.number }}" data-search="{{ pull.number }}" data-status="{{ pull.state }}" type="radio" name="reference" value="pull/{{ pull.number }}">
                    <label for="pr{{ pull.number }}" title="{{ pull.title }}">
                        <svg class="icon {{ pull.state }}" viewBox="0 0 32 32"><use xlink:href="#pull"></use></svg>
                        <span class="js-title">{{ pull.title }}</span>
                        <br />

                        <a href="{{ githubPullRequest(repo.githubUser, repo.githubRepo, pull.number) }}">PR #{{ pull.number }}</a>
                        <svg class="icon" viewBox="0 0 32 32"><use xlink:href="#github"></use></svg>
                        <br />

                        <span class="pr-smtxt">From <span class="pr-label" title="{{ pull.head.user.login }}:{{ pull.head.ref }}">{{ pull.head.user.login }}:{{ pull.head.ref }}</span><br />to <span class="pr-label" title="{{ pull.base.ref }}">{{ pull.base.ref }}</span></span>
                    </label>
                </li>
            {% else %}
                <li class="full">There are no closed pull requests.</li>
            {% endfor %}
        </ul>
      </div>

      <div>
          <input class="text-input js-commitId" type="hidden" name="gitref">
      </div>

    </div>

    <input class="btn btn--action" type="submit" value="Start Build" name="submit">

    </form>

{% endblock %}
