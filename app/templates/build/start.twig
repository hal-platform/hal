{% extends 'base.html.twig' %}

{% set page_title = "Create new "~repo.key~" build" %}

{% block content %}

    <h2>Create new {{ repo.key }} build</h2>

    <p><a class="btn--small btn--back" href="{{ urlFor('repository.status', {'id': repo.id}) }}">Back to Repository status</a></p>

    <form method="post" action="{{ urlFor('build.handle', {'id': repo.id}) }}">

    <h3>Choose what environment to build for:</h3>
    <ul class="check-list radio-grid radio-grid__env">
    {% for env in environments %}
        <li>
            <input id="env-{{ env.key }}" type="radio" name="environment" value="{{ env.key }}">
            <label for="env-{{ env.key }}">{{ env.key }}</label>
        </li>
    {% endfor %}
    </ul>

    <h3>Choose what to build:</h3>

    <ul class="form-fields form-wrapper">
        <li class="mbn">
            <label for="search">Search for a Branch, Tag, Pull Request, or enter a Commit ID.</label>
            <input class="text-input js-search-input" type="text" id="search" name="search" autocomplete="off">
        </li>
    </ul>

    <div class="drop-down js-search-drop">
        <ul class="list--bare js-search-results">
            <!-- search results go here -->
        </ul>
    </div>
      <ul class="nav tabs js-tabs">
          <li class="active"><a name="js-tab1">Branches</a></li>
          <li><a name="js-tab2">Tags</a></li>
          <li><a name="js-tab3">Open Pull Requests</a></li>
          <li><a name="js-tab4">Closed Pull Requests</a></li>
      </ul>

    <div class="tab-content js-tab-content">
      <div data-id="js-tab1" class="tab js-tab-active js-tab1">
        <ul data-type="branch" class="check-list js-search-list radio-grid">
        {% for branch in branches %}
            <li>
                <input id="{{ branch.object.sha }}-{{ branch.name }}" type="radio" name="reference" value="{{ branch.name }}">
                <label for="{{ branch.object.sha }}-{{ branch.name }}">
                    <span class="icon">
                        <svg viewBox="0 0 32 32">
                            <use xlink:href="#branch"></use>
                        </svg>
                    </span>
                    {{ branch.name }} <br />(<a href="{{ githubTreeish(repo.GithubUser, repo.GithubRepo, branch.name) }}">{{ branch.object.sha[:7] }}</a>
                        <span class="icon">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#github"></use>
                            </svg>
                        </span>)
                </label>
            </li>
        {% else %}
            <li>There are no branches.</li>
        {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab2" class="tab js-tab2">
        <ul data-type="tag" class="check-list js-search-list radio-grid">
        {% for tag in tags %}
            <li>
                <input id="{{ tag.object.sha }}-{{ tag.name }}" type="radio" name="reference" value="tag/{{ tag.name }}">
                <label for="{{ tag.object.sha }}-{{ tag.name }}">
                    <span class="icon">
                        <svg viewBox="0 0 32 32">
                            <use xlink:href="#tag"></use>
                        </svg>
                    </span>
                    {{ tag.name }} <br />(<a href="{{ githubTreeish(repo.GithubUser, repo.GithubRepo, tag.name) }}">{{ tag.object.sha[:7] }}</a>
                        <span class="icon">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#github"></use>
                            </svg>
                        </span>)
                </label>
            </li>
        {% else %}
            <li>There are no tags.</li>
        {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab3" class="tab js-tab3">
        <ul data-type="pull" class="check-list js-search-list radio-grid">
            {% for pull in pulls %}
                <li class="pr-selection">
                    <input id="pr{{ pull.number }}" type="radio" name="reference" value="pull/{{ pull.number }}">
                    <label for="pr{{ pull.number }}">
                        <span class="icon {{ pull.state }}">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#pull"></use>
                            </svg>
                        </span>
                        <span class="js-title">{{ pull.title }}</span>
                        <br /><a href="{{ githubPullRequest(repo.githubUser, repo.githubRepo, pull.number) }}">PR #{{ pull.number }}</a>
                        <span class="icon">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#github"></use>
                            </svg>
                        </span>
                        <br />
                        <span class="pr-smtxt">From <span class="pr-label">{{ pull.head.user.login }}:{{ pull.head.ref }}</span><br />to <span class="pr-label">{{ pull.base.ref }}</span></span>
                    </label>
                </li>
            {% else %}
                <li>There are no open pull requests.</li>
            {% endfor %}
        </ul>
      </div>

      <div data-id="js-tab4" class="tab js-tab4">
        <ul data-type="pull" class="check-list js-search-list radio-grid">
            {% for pull in closed_pulls %}
                <li class="pr-selection">
                    <input id="pr{{ pull.number }}" type="radio" name="reference" value="pull/{{ pull.number }}">
                    <label for="pr{{ pull.number }}">
                        <span class="icon {{ pull.state }}">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#pull"></use>
                            </svg>
                        </span>
                        <span class="js-title">{{ pull.title }}</span>
                        <br /><a href="{{ githubPullRequest(repo.githubUser, repo.githubRepo, pull.number) }}">PR #{{ pull.number }}</a>
                        <span class="icon">
                            <svg viewBox="0 0 32 32">
                                <use xlink:href="#github"></use>
                            </svg>
                        </span>
                        <br />
                        <span class="pr-smtxt">From <span class="pr-label">{{ pull.head.user.login }}:{{ pull.head.ref }}</span><br />to <span class="pr-label">{{ pull.base.ref }}</span></span>

                    </label>
                </li>
            {% else %}
                <li>There are no closed pull requests.</li>
            {% endfor %}
        </ul>
      </div>

      <div>
          <input class="text-input js-commitId" type="hidden" name="gitref">
      </div>

    </div>

    <input class="btn" type="submit" value="Start Build" name="submit">

    </form>

{% endblock %}
