{% extends 'layout.html.twig' %}

{% import _self as macros %}

{% set buster = applicationSha[:4] ?: 'dev' ~ 'now'|date('U') %}

{% block head %}
    <title>
        {% if page_title %}{{ page_title }} - {% endif %}{{ applicationTitle }}
    </title>
    {% block icon %}
        <link type="image/x-icon" rel="shortcut icon" href="/hal.ico"> <!-- for ie -->
        <link type="image/png" rel="apple-touch-icon-precomposed" sizes="57x57" href="/hal-57px.png"> <!-- for apple -->
        <link type="image/png" rel="apple-touch-icon-precomposed" sizes="72x72" href="/hal-72px.png"> <!-- for apple -->
        <link type="image/png" rel="apple-touch-icon-precomposed" sizes="114x114" href="/hal-114px.png"> <!-- for apple -->
        <link type="image/png" rel="apple-touch-icon-precomposed" sizes="144x144" href="/hal-144px.png"> <!-- for apple -->
        <link type="image/png" rel="icon" href="/hal.png"> <!-- for the rest of the world -->
    {% endblock %}
    {% block meta %}
        <meta name="format-detection" content="telephone=no">
    {% endblock %}
    {% block style %}
        <link rel="stylesheet" href="/css/style.css?v={{ buster }}">
    {% endblock %}
{% endblock %}

{% block body %}

    {% include 'partials/icons.twig' %}

    <!-- BEGIN HEADER -->
    {% block header %}
        <header role="banner">
            <div class="hal">
                <a href="/" class="wrapper">

                    <h1 class="hal-label">
                        <span class="hal-label__name">HAL</span>
                        <span class="hal-label__version">9000</span>
                    </h1>

                    <div class="hal-eye circular">
                        <div class="ring circular"></div>
                        <div class="oculus circular">
                            <div class="iris circular narrow"></div>
                            <div class="iris circular wide"></div>
                            <div class="highlight alpha"></div>
                            <div class="highlight"></div>
                            <div class="highlight beta"></div>
                        </div>
                    </div>

                </a>
            </div>
            {% block navigation %}
                <nav role="navigation">
                    <ul class="nav--main mbn">
                        {% if currentUser %}
                            <li>{{ macros.navlink('Dashboard', urlFor('dashboard'), 'dashboard', '-3 0') }}</li>
                            <li>{{ macros.navlink('Groups', urlFor('groups'), 'list') }}</li>

                            {% if isUserAdmin(currentUser) %}
                                <li>{{ macros.navlink('Servers', urlFor('servers'), 'server', '-4 0') }}</li>
                                <li>{{ macros.navlink('Repositories', urlFor('repositories'), 'repo', '-3 0') }}</li>
                                <li>{{ macros.navlink('Environments', urlFor('environments'), 'leaf', '-1 0') }}</li>
                                <li>{{ macros.navlink('Users', urlFor('users'), 'users') }}</li>
                                <li>{{ macros.navlink('Logs', urlFor('logs', {'page': '1'}), 'paper-roll') }}</li>
                            {% endif %}

                            <li>{{ macros.navlink('Profile', urlFor('user.current'), 'user-card') }}</li>
                            <li>{{ macros.navlink('Help', urlFor('help'), 'question', '-6 0') }}</li>
                            <li>{{ macros.navlink('Logout', urlFor('logout'), 'sign-out') }}</li>

                        {% else %}
                            <li class="signed-out">{{ macros.navlink('Help', urlFor('help'), 'question', '-6 0') }}</li>
                            <li class="signed-out">{{ macros.navlink('Login', urlFor('login'), 'sign-in') }}</li>
                        {% endif %}
                    </ul>
                </nav>
            {% endblock %}
            {% block subnav %}{% endblock %}
        </header>
    {% endblock %}
    <!-- END HEADER -->

    <main role="main">
        {% block flash %}
            {% if session.hasFlash() %}
                <div class="alert-bar">
                    {% for message in session.getFlash() %}
                        <p>{{ message|raw }}</p>
                    {% endfor %}
                </div>
            {% endif %}
        {% endblock %}
        {% block messages %}
            {# GLOBAL NOTICE #}
            {% if notice %}
                <div class="alert-bar">
                    <p>{{ notice|raw }}</p>
                </div>
            {% endif %}
            {# GLOBAL ERROR #}
            {% if error %}
                <div class="alert-bar">
                    <p>{{ error|raw }}</p>
                </div>
            {% endif %}
        {% endblock %}
        <!-- BEGIN CONTENT -->
        {% block content %}{% endblock %}
        <!-- END CONTENT -->
    </main>

    <!-- BEGIN FOOTER -->
    {% block footer %}
    {% endblock %}
    <!-- END FOOTER -->

{% endblock %}

{% block script %}
    <script data-main="/js/main.js?v={{ buster }}" src="/js/vendor/require-2.1.11.min.js"></script>
    {% block pageScript %}{% endblock %}
    {% if (not user or (user and showAnalytics(user))) %}
        <!-- BEGIN ANLYTICS -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-8298397-8', 'auto');
            ga('send', 'pageview');
        </script>
        <!-- END ANLYTICS -->
    {% endif %}
{% endblock %}

{% macro navlink(title, link, icon, viewbox) %}
    <a href="{{ link }}" title="{{ title }}">
        <svg class="icon" viewBox="{{ viewbox|default('0 0') }} 32 32">
            <use xlink:href="#{{ icon }}"></use>
        </svg>
        {{ title }}
    </a>
{% endmacro %}
